# High-quality rendering on peregrine with ParaView 

How to use batch ParaView with OSPRay to generate single frames and
animations on peregrine

![](/assets/paraview.png)

Step-by-step guide
------------------

  

1.  Log on to a peregrine login node:

        ssh peregrine

     

2.  Start an interactive session:  

        qsub -A YOURALLOC -I

     

3.  Once the session starts, load the appropriate modules:  

        module purge
        module load gcc/6.2.0 openmpi-gcc/2.0.1-6.2.0 python/2.7.6 paraview/5.4.1-compute

     

4.  And start your render job:  

        pvbatch --use-offscreen-rendering pvrender.py

 

Once you feel that your script is automated enough, start submitting
batch jobs.

1.  Prepare your script for `qsub`. A short job might look like this:  

        #!/bin/bash
        #PBS -A YOURALLOC
        #PBS -l nodes=1:ppn=1
        #PBS -l walltime=0:01:00
        #PBS -q short
        module purge
        module load gcc/6.2.0 openmpi-gcc/2.0.1-6.2.0 python/2.7.6 paraview/5.4.1-compute
        pvbatch --use-offscreen-rendering pvrender.py

     

2.  Submit the job and wait:  

        qsub batchrender.sh

     

Creating the ParaView python script
-----------------------------------

Your ParaView python script can be made in a number of ways. The easiest
is to run a fresh session of ParaView (use version 5.x on your local
machine) and select "Tools→Start Trace," then "OK". Perform all the
actions you need to set your scene and save a screenshot. Then select
"Tools → Stop Trace" and save the resulting python script (we will use
`pvrender.py` in these examples).

 

Here are some useful components to add to your ParaView Python script.

-   Read the first command-line argument and use it to select a data
    file to operate on.  

        import sys
        doframe = 0
        if len(sys.argv) > 1:
          doframe = int(sys.argv[1])
        infile = "output%05d.dat" % doframe

    Note that `pvbatch` will pass any arguments after the script name to
    the script itself. So you can do the following to render frame 45:

        pvbatch --use-offscreen-rendering pvrender.py 45

    But were you to use this in a `qsub` script, your script would need
    to have the line

        pvbatch --use-offscreen-rendering pvrender.py $1

    And you would need to submit the script as such:

        qsub -F "45" batchrender.sh

     

-   Set the output image size to match FHD or UHD standards:

        renderView1.ViewSize = [3840, 2160]
        renderView1.ViewSize = [1920, 1080]

     

-   Enable OSPRay rendering and set parameters for high-quality output:

        renderView1.LightScale = 1.5
        renderView1.AmbientSamples = 4
        renderView1.SamplesPerPixel = 9
        renderView1.Shadows = 1
        renderView1.EnableOSPRay = 1

     

-   Don't forget to actually render the image!

        pngname = "image%05d.png" % doframe
        SaveScreenshot(pngname, renderView1)

 

 

Attachments:
------------

![](images/icons/bullet_blue.gif)
[frame0100\_img3sm.png](attachments/18594270/28148762.png) (image/png)  

Document generated by Confluence on 2019-04-03 10:15

[Atlassian](http://www.atlassian.com/)
