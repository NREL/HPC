# High-quality Rendering on Eagle With ParaView 

How to use ParaView in batch mode to generate single frames and animations on Eagle

![](/assets/paraview.png)

Step-by-step guide
------------------

  

1.  Begin by connecting to an Eagle login node:

        ssh {username}@eagle.hpc.nrel.gov
     

2.  Request an interactive compute session:

        srun -A {allocation} -t 60 --pty $SHELL
     

3.  Once the session starts, load the appropriate modules:  

        module purge
        module load paraview/osmesa

    Note: In this case, we select the `paraview/osmesa` module as opposed to the default ParaView build, 
    as the osmesa version is built for rendering using offscreen methods suitable for compute nodes.
     

4.  and start your render job:  

        srun -n 1 pvbatch --force-offscreen-rendering render_sphere.py

    where `render_sphere.py` is a simple ParaView Python script to add a sphere source and 
    save an image.


Tweaking the visualization options contained in the `pvrender.py` file inevitably requires some amount of trial 
and error and is most easily accomplished in an interactive compute session like the one outlined above.  Once 
you feel that your script is sufficiently automated, you can start submitting batch jobs that require no user interaction.

1.  Prepare your script for `sbatch`. A minimal example of a batch script named `batch_render.sh` could look like:  

        #!/bin/bash

        #SBATCH --account={allocation}
        #SBATCH --time=60:00
        #SBATCH --job-name=pvrender
        #SBATCH --nodes=2

        module purge
        module load paraview/osmesa

        srun -n 1 pvbatch --force-offscreen-rendering render_sphere.py 1 &
        srun -n 1 pvbatch --force-offscreen-rendering render_sphere.py 2 &
        srun -n 1 pvbatch --force-offscreen-rendering render_sphere.py 3 &

        wait

    where we run multiple instances of our dummy sphere example, highlighting that different options can be
    passed to each to post-process a large batch of simulated results on a single node.  Note also that for more 
    computationally intensize rendering or larger file sizes (e.g., tens of millions of cells) the option `-n 1` 
    option can be set as suggested in the [client-server guide](client_server_setup.md).


2.  Submit the job and wait:  

        sbatch batch_render.sh


Creating the ParaView python script
-----------------------------------

Your ParaView python script can be made in a number of ways. The easiest
is to run a fresh session of ParaView (use version 5.x on your local
machine) and select "Tools→Start Trace," then "OK". Perform all the
actions you need to set your scene and save a screenshot. Then select
"Tools → Stop Trace" and save the resulting python script (we will use
`render_sphere.py` in these examples).
 

Here are some useful components to add to your ParaView Python script.

-   Read the first command-line argument and use it to select a data
    file to operate on.  

        import sys
        doframe = 0
        if len(sys.argv) > 1:
            doframe = int(sys.argv[1])
        infile = "output%05d.dat" % doframe

    Note that `pvbatch` will pass any arguments after the script name to
    the script itself. So you can do the following to render frame 45:

        srun -n 1 pvbatch --force-offscreen-rendering render_sphere.py 45

    You could programmatically change this value inside the `sbatch` script, your script would need
    to iterate using something like:

        for frame in 45 46 47 48
        do
            srun -n 1 pvbatch --force-offscreen-rendering render_sphere.py $frame
        done

<!--     And you would need to submit the script as such:

        sbatch -F "45" batchrender.sh -->

     

-   Set the output image size to match FHD or UHD standards:

        renderView1.ViewSize = [3840, 2160]
        renderView1.ViewSize = [1920, 1080]

     

<!-- -   Enable OSPRay rendering and set parameters for high-quality output:

        renderView1.LightScale = 1.5
        renderView1.AmbientSamples = 4
        renderView1.SamplesPerPixel = 9
        renderView1.Shadows = 1
        renderView1.EnableOSPRay = 1

 -->     

-   Don't forget to actually render the image!

        pngname = "image%05d.png" % doframe
        SaveScreenshot(pngname, renderView1)

 

 

<!-- Attachments:
------------

![](images/icons/bullet_blue.gif)
[frame0100\_img3sm.png](attachments/18594270/28148762.png) (image/png)  

Document generated by Confluence on 2019-04-03 10:15

[Atlassian](http://www.atlassian.com/)
 -->