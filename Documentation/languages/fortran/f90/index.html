
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduce Fortran 90 concepts to Fortran 77 programers">
      
      
      
        <meta name="author" content="Tim Kaiser">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>Fortran 90 for Fortran 77 programmers - NREL HPC</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    
      

  


  

  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-189117140-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-fortran-90" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="NREL HPC" class="md-header__button md-logo" aria-label="NREL HPC" data-md-component="logo">
      
  <img src="../../../../assets/images/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NREL HPC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fortran 90 for Fortran 77 programmers
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/NREL/HPC/tree/gh-pages/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    NREL/HPC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../Announcements/2020-11-03-announcement/" class="md-tabs__link">
        Announcements
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../Data-and-File-Systems/File-Systems/filesystemsio/" class="md-tabs__link md-tabs__link--active">
        Documentation
      </a>
    </li>
  

  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../blog/2020-12-01-numba/" class="md-tabs__link">
        Blog
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="NREL HPC" class="md-nav__button md-logo" aria-label="NREL HPC" data-md-component="logo">
      
  <img src="../../../../assets/images/favicon.png" alt="logo">

    </a>
    NREL HPC
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/NREL/HPC/tree/gh-pages/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    NREL/HPC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Announcements
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Announcements" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Announcements
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2020-11-03-announcement/" class="md-nav__link">
        November 2020 Monthly Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2020-12-03-announcement/" class="md-nav__link">
        December 2020 Monthly Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2021-01-04-announcement/" class="md-nav__link">
        January 2021 Monthly Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2021-02-02-announcement/" class="md-nav__link">
        February 2021 Monthly Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2021-03-03-announcement/" class="md-nav__link">
        March 2021 Monthly Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2021-04-06-announcement/" class="md-nav__link">
        April 2021 Monthly Update
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Announcements/2021-05-05-announcement/" class="md-nav__link">
        May 2021 Monthly Update
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Data and File Systems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data and File Systems" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Data and File Systems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_1" type="checkbox" id="__nav_3_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_1">
          File Systems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="File Systems" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_1">
          <span class="md-nav__icon md-icon"></span>
          File Systems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Data-and-File-Systems/File-Systems/filesystemsio/" class="md-nav__link">
        File Systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_1_2" type="checkbox" id="__nav_3_1_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_1_2">
          Lustre
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lustre" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_1_2">
          <span class="md-nav__icon md-icon"></span>
          Lustre
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Data-and-File-Systems/File-Systems/Lustre/lustrebestpractices/" class="md-nav__link">
        Lustre Best Practices
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_2" type="checkbox" id="__nav_3_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_2">
          Transferring Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Transferring Data" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Transferring Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Data-and-File-Systems/Transferring-Data/FileZilla/" class="md-nav__link">
        FileZilla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Data-and-File-Systems/Transferring-Data/file-transfers/" class="md-nav__link">
        File Transfers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Data-and-File-Systems/Transferring-Data/globus/" class="md-nav__link">
        Globus
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Environments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Environments" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Environments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/conda/" class="md-nav__link">
        Conda
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_2" type="checkbox" id="__nav_3_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_2">
          Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Containers" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_2">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/Containers/intro/" class="md-nav__link">
        Containers Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/Containers/singularity/" class="md-nav__link">
        Singularity on Eagle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/Containers/tensorflow/" class="md-nav__link">
        Containerized TensorFlow
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2_3" type="checkbox" id="__nav_3_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2_3">
          Building packages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Building packages" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_2_3">
          <span class="md-nav__icon md-icon"></span>
          Building packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/building-packages/a-building-packages/" class="md-nav__link">
        Building Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/building-packages/b-acquire/" class="md-nav__link">
        Acquire
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/building-packages/c-config_make_install/" class="md-nav__link">
        Config Make Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Environments/building-packages/d-modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Jupyter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Jupyter" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Jupyter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Jupyter/jupyterhub/" class="md-nav__link">
        JupyterHub
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Systems
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Systems" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Systems
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Systems/systems/" class="md-nav__link">
        Systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4_2" type="checkbox" id="__nav_3_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4_2">
          Swift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Swift" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_4_2">
          <span class="md-nav__icon md-icon"></span>
          Swift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Systems/Swift/applications/" class="md-nav__link">
        Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Systems/Swift/modules/" class="md-nav__link">
        Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Systems/Swift/running/" class="md-nav__link">
        Running on Swift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Systems/Swift/swift/" class="md-nav__link">
        Swift
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Languages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Languages" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Languages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_1" type="checkbox" id="__nav_3_5_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5_1">
          Fortran
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Fortran" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_1">
          <span class="md-nav__icon md-icon"></span>
          Fortran
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Fortran 90 for Fortran 77 programmers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Fortran 90 for Fortran 77 programmers
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#format-for-our-presentation" class="md-nav__link">
    Format for our presentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-was-in-mind-of-the-language-writers-what-were-they-thinking" class="md-nav__link">
    What was in mind of the language writers? What were they thinking?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-fortran" class="md-nav__link">
    Why Fortran?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#justification-of-topics" class="md-nav__link">
    Justification of topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classification-of-topics" class="md-nav__link">
    Classification of topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing_of_topics_covered" class="md-nav__link">
    Listing_of_topics_covered
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-genetic-algorithm" class="md-nav__link">
    What is a Genetic Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-algorithm-for-a-ga" class="md-nav__link">
    Simple algorithm for a GA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#our-example-problem" class="md-nav__link">
    Our example problem
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_2" type="checkbox" id="__nav_3_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_5_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/NREL_python/" class="md-nav__link">
        NREL HPC Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_2_3" type="checkbox" id="__nav_3_5_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5_2_3">
          Dask
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Dask" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_5_2_3">
          <span class="md-nav__icon md-icon"></span>
          Dask
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/dask/dask/" class="md-nav__link">
        Dask
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Blog" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/2020-12-01-numba/" class="md-nav__link">
        Speeding up Python Code with Numba
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/2021-05-06-tf/" class="md-nav__link">
        Faster Machine Learning with Custom Built TensorFlow on Eagle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../blog/2021-06-18-srun/" class="md-nav__link">
        Using srun to launch applications under slurm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#format-for-our-presentation" class="md-nav__link">
    Format for our presentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-was-in-mind-of-the-language-writers-what-were-they-thinking" class="md-nav__link">
    What was in mind of the language writers? What were they thinking?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-fortran" class="md-nav__link">
    Why Fortran?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#justification-of-topics" class="md-nav__link">
    Justification of topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classification-of-topics" class="md-nav__link">
    Classification of topics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing_of_topics_covered" class="md-nav__link">
    Listing_of_topics_covered
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-a-genetic-algorithm" class="md-nav__link">
    What is a Genetic Algorithm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simple-algorithm-for-a-ga" class="md-nav__link">
    Simple algorithm for a GA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#our-example-problem" class="md-nav__link">
    Our example problem
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/NREL/HPC/tree/gh-pages/edit/master/docs/Documentation/languages/fortran/f90.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="advanced-fortran-90">Advanced Fortran 90</h1>
<p>This document is derived from an HTML page written at the <a href="https://www.sdsc.edu">San Diego Supercomper Center</a> many years ago.<br />
Its purpose is to Introduce Fortran 90 concepts to Fortran 77 programers.  It does this by presenting an example program and introducing concepts as various routines of the program are presented.  The original web page has been used over the years and has been translated into several languages. </p>
<hr />
<hr />
<!-- 
### Timothy H. Kaiser,Ph.D.
#### Written:  Summer 1997

- - -
- - -

## Introduction
- Personal Introduction
- The mind of the language writers
- Justification for topics covered
- Classification of topics covered
- Listing of covered topics
- Format of our presentation
- Meat

- - -
- - -

## Who am I?
- Wide experience background
    - Physics
    -  **Electrical Engineering**            
    -  Computer Science
- .gt. 25 years programming        
    - Defense Industry           
    - Academia
-  Languages
    -  Fortran
    -  C
    -  C++
    -  Pascal
    -  Lisp
    -  Java
    -  Python
    -  Others

-  Beta tester of several Fortran compilers
-  I have had the chance to make just about every mistake in the book and
    some that ain't

- - -
- - -
 -->

<h2 id="format-for-our-presentation">Format for our presentation</h2>
<ul>
<li>We will "develop" an application<ul>
<li>Incorporate f90 features</li>
<li>Show source code</li>
<li>Explain what and why as we do it</li>
</ul>
</li>
<li>Application is a genetic algorithm<ul>
<li>Easy to understand and program</li>
<li>Offers rich opportunities for enhancement</li>
</ul>
</li>
<li>We also provide an summary of F90 syntax, key words, operators, constants, and functions</li>
</ul>
<hr />
<hr />
<h2 id="what-was-in-mind-of-the-language-writers-what-were-they-thinking">What was in mind of the language writers? What were they thinking?</h2>
<ul>
<li>Enable portable codes<ul>
<li>Same precision</li>
<li>Include many common extensions</li>
</ul>
</li>
<li>More reliable programs</li>
<li>Getting away from underlying hardware</li>
<li>Move toward parallel programming</li>
<li>Run old programs</li>
<li>Ease of programming<ul>
<li>Writing</li>
<li>Maintaining</li>
<li>Understanding</li>
<li>Reading</li>
</ul>
</li>
<li>Recover C and C++ users</li>
</ul>
<hr />
<hr />
<h2 id="why-fortran">Why Fortran?</h2>
<p>Famous Quote: <em>"I don't know what the technical characteristics of
 </em>the standard language for scientific and engineering<em>
 </em>computation in the year 2000 will be... but I know it<em>
 </em>will be called Fortran." John Backus.* </p>
<p>### Note: He claimed that he never said this.</p>
<ul>
<li>Language of choice for Scientific programming</li>
<li>Large installed user base.</li>
<li>Fortran 90 has most of the features of C . . . and then some</li>
<li>The compilers produce better programs</li>
</ul>
<hr />
<hr />
<h2 id="justification-of-topics">Justification of topics</h2>
<ul>
<li>Enhance performance</li>
<li>Enhance portability</li>
<li>Enhance reliability</li>
<li>Enhance maintainability</li>
</ul>
<hr />
<hr />
<h2 id="classification-of-topics">Classification of topics</h2>
<ul>
<li>New useful features</li>
<li>Old tricks</li>
<li>Power features</li>
<li>Overview of F90</li>
</ul>
<hr />
<hr />
<h2 id="listing_of_topics_covered">Listing_of_topics_covered</h2>
<ol>
<li><a href="#listing-of-topics-covered">Listing of topics covered</a></li>
<li><a href="#what-is-a-genetic-algorithm">What is a Genetic Algorithm</a></li>
<li><a href="#simple-algorithm-for-a-ga">Simple algorithm for a GA</a></li>
<li><a href="#our-example-problem">Our example problem</a></li>
<li><a href="#start-of-real-fortran-90-discussion">Start of real Fortran 90 discussion</a></li>
<li><a href="#comparing-a-fortran-77-routine-to-a-fortran-90-routine">Comparing a FORTRAN 77 routine to a Fortran 90 routine</a></li>
<li><a href="#obsolescent-features">Obsolescent features</a></li>
<li><a href="#new-source-form-and-related-things">New source Form and related things</a></li>
<li><a href="#new-data-declaration-method">New data declaration method</a></li>
<li><a href="#kind-facility">Kind facility</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#module-functions-and-subroutines">Module functions and subroutines</a></li>
<li><a href="#allocatable-arrays-(the-basics)">Allocatable arrays (the basics)</a></li>
<li><a href="#passing-arrays-to-subroutines">Passing arrays to subroutines</a></li>
<li><a href="#interface-for-passing-arrays">Interface for passing arrays</a></li>
<li><a href="#optional-arguments-and-intent">Optional arguments and intent</a></li>
<li><a href="#derived-data-types">Derived data types</a></li>
<li><a href="#using-defined-types">Using defined types</a></li>
<li><a href="#user-defined-operators">User defined operators</a></li>
<li><a href="#recursive-functions-introduction">Recursive functions introduction</a></li>
<li><a href="#fortran-90-recursive-functions">Fortran 90 recursive functions</a></li>
<li><a href="#pointers">Pointers</a></li>
<li><a href="#function-and-subroutine-overloading">Function and subroutine overloading</a></li>
<li><a href="#fortran-minval-and-minloc-routines">Fortran Minval and Minloc routines</a></li>
<li><a href="#pointer-assignment">Pointer assignment</a></li>
<li><a href="#more-pointer-usage,-association-and-nullify">More pointer usage, association and nullify</a></li>
<li><a href="#pointer-usage-to-reference-an-array">Pointer usage to reference an array</a></li>
<li><a href="#data-assignment-with-structures">Data assignment with structures</a></li>
<li><a href="#using-the-user-defined-operator">Using the user defined operator</a></li>
<li><a href="#passing-arrays-with-a-given-arbitrary-lower-bounds">Passing arrays with a given arbitrary lower bounds</a></li>
<li><a href="#using-pointers-to-access-sections-of-arrays">Using pointers to access sections of arrays</a></li>
<li><a href="#allocating-an-array-inside-a-subroutine">Allocating an array inside a subroutine</a></li>
<li><a href="#our-fitness-function">Our fitness function</a></li>
<li><a href="#linked-lists">Linked lists</a></li>
<li><a href="#linked-list-usage">Linked list usage</a></li>
<li><a href="#our-map-representation">Our map representation</a></li>
<li><a href="#date-and-time-functions">Date and time functions</a></li>
<li><a href="#non-advancing-and-character-io">Non advancing and character IO</a></li>
<li><a href="#internal-io">Internal IO</a></li>
<li><a href="#inquire-function">Inquire function</a></li>
<li><a href="#namelist">Namelist</a></li>
<li><a href="#vector-valued-functions">Vector valued functions</a></li>
<li><a href="#complete-source-for-recent-discussions">Complete source for recent discussions</a></li>
<li><a href="#some-array-specific-intrinsic-functions">Some array specific intrinsic functions</a></li>
<li><a href="#the-rest-of-our-ga">The rest of our GA</a></li>
<li><a href="#compiler-information">Compiler Information</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#overview_of_f90">Overview of F90</a></li>
<li><a href="#fortran-95">Fortran 95</a></li>
<li><a href="#references">References</a></li>
</ol>
<hr />
<hr />
<h2 id="what-is-a-genetic-algorithm">What is a Genetic Algorithm</h2>
<ul>
<li>A "suboptimization" system<ul>
<li>Find good, but maybe not optimal, solutions to difficult problems</li>
<li>Often used on NP-Hard or combinatorial optimization problems</li>
</ul>
</li>
<li>Requirements<ul>
<li>Solution(s) to the problem represented as a string</li>
<li>A fitness function<ul>
<li>Takes as input the solution string</li>
<li>Output the desirability of the solution</li>
</ul>
</li>
<li>A method of combining solution strings to generate new solutions</li>
</ul>
</li>
<li>Find solutions to problems by Darwinian evolution<ul>
<li>Potential solutions ar though of as living entities in a population</li>
<li>The strings are the genetic codes for the individuals</li>
<li>Fittest individuals are allowed to survive to reproduce</li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="simple-algorithm-for-a-ga">Simple algorithm for a GA</h2>
<ul>
<li>Generate a initial population, a collection of strings</li>
<li>do for some time<ul>
<li>evaluate each individual (string) of the population using the fitness function</li>
<li>sort the population with fittest coming to the top</li>
<li>allow the fittest individuals to "sexually" reproduce replacing the old
    population</li>
<li>allow for mutation</li>
</ul>
</li>
<li>end do</li>
</ul>
<hr />
<hr />
<h2 id="our-example-problem">Our example problem</h2>
<ul>
<li>Instance:Given a map of the N  states or countries and a fixed number of colors</li>
<li>Find a coloring of the map, if it exists, such that no two states that share a boarder have the same color</li>
<li>Notes
        - In general, for a fixed number of colors and an arbitrary map the only
                known way to find if there is a valid coloring is a brute force search
                with the number of combinations = (NUMBER_OF_COLORS)**(NSTATES)<ul>
<li>The strings of our population are integer vectors represent the coloring</li>
<li>Our fitness function returns the number of boarder violations</li>
<li>The GA searches for a mapping with few, hopefully 0 violations</li>
<li>This problem is related to several important NP_HARD problems in computer science<ul>
<li>Processor scheduling</li>
<li>Communication and grid allocation for parallel computing</li>
<li>Routing</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<hr />
<h1 id="start-of-real-fortran-90-discussion">Start of real Fortran 90 discussion</h1>
<hr />
<hr />
<h2 id="comparing-a-fortran-77-routine-to-a-fortran-90-routine">Comparing a FORTRAN 77 routine to a Fortran 90 routine</h2>
<ul>
<li>The routine is one of the random number generators from:  <em>Numerical Recipes, The Art of Scientific Computing. Press, Teukolsky, Vetterling and Flannery.  Cambridge University Press 1986.</em></li>
<li>Changes<ul>
<li>correct bugs</li>
<li>increase functionality</li>
<li>aid portability</li>
</ul>
</li>
</ul>
<h3 id="original">Original</h3>
<div class="highlight"><pre><span></span><code>    <span class="k">function </span><span class="n">ran1</span><span class="p">(</span><span class="n">idum</span><span class="p">)</span>
        <span class="kt">real </span><span class="n">ran1</span>
        <span class="kt">integer </span><span class="n">idum</span>
        <span class="kt">real </span><span class="n">r</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span>
        <span class="k">parameter</span> <span class="p">(</span> <span class="n">m1</span><span class="o">=</span><span class="mi">259200</span><span class="p">,</span><span class="n">ia1</span><span class="o">=</span><span class="mi">7141</span><span class="p">,</span><span class="n">ic1</span><span class="o">=</span><span class="mi">54773</span><span class="p">)</span>
        <span class="k">parameter</span> <span class="p">(</span> <span class="n">m2</span><span class="o">=</span><span class="mi">134456</span><span class="p">,</span><span class="n">ia2</span><span class="o">=</span><span class="mi">8121</span><span class="p">,</span><span class="n">ic2</span><span class="o">=</span><span class="mi">28411</span><span class="p">)</span>
        <span class="k">parameter</span> <span class="p">(</span> <span class="n">m3</span><span class="o">=</span><span class="mi">243000</span><span class="p">,</span><span class="n">ia3</span><span class="o">=</span><span class="mi">4561</span><span class="p">,</span><span class="n">ic3</span><span class="o">=</span><span class="mi">51349</span><span class="p">)</span>
        <span class="kt">integer </span><span class="n">j</span>
        <span class="kt">integer </span><span class="n">iff</span><span class="p">,</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span>
        <span class="k">data </span><span class="n">iff</span> <span class="o">/</span><span class="mi">0</span><span class="o">/</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idum</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.</span><span class="nb">or</span><span class="p">.</span><span class="n">iff</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<span class="k">            </span><span class="n">rm1</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">m1</span>
            <span class="n">rm2</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">m2</span>
            <span class="n">iff</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ic1</span><span class="o">-</span><span class="n">idum</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
            <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
            <span class="n">ix2</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
            <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
            <span class="n">ix3</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span>
            <span class="k">do </span><span class="mi">11</span> <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">97</span>
                <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
                <span class="n">ix2</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia2</span><span class="o">*</span><span class="n">ix2</span><span class="o">+</span><span class="n">ic2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
                <span class="n">r</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">ix1</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="n">ix2</span><span class="p">)</span><span class="o">*</span><span class="n">rm2</span><span class="p">)</span><span class="o">*</span><span class="n">rm1</span>
 <span class="mi">11</span>           <span class="k">continue</span>
<span class="k">            </span><span class="n">idum</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">endif</span>
<span class="k">        </span><span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
        <span class="n">ix2</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia2</span><span class="o">*</span><span class="n">ix2</span><span class="o">+</span><span class="n">ic2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
        <span class="n">ix3</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia3</span><span class="o">*</span><span class="n">ix3</span><span class="o">+</span><span class="n">ic3</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span>
        <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">97</span><span class="o">*</span><span class="n">ix3</span><span class="p">)</span><span class="o">/</span><span class="n">m3</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">9</span><span class="mf">7.</span><span class="nb">or</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39; error in ran1 j=&#39;</span><span class="p">,</span><span class="n">j</span>
            <span class="k">stop</span>
<span class="k">        endif</span>
<span class="k">        </span><span class="n">ran1</span><span class="o">=</span><span class="n">r</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">r</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">ix1</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="n">ix2</span><span class="p">)</span><span class="o">*</span><span class="n">rm2</span><span class="p">)</span><span class="o">*</span><span class="n">rm1</span>
        <span class="k">return</span>
<span class="k">     end</span> 
</code></pre></div>
<h3 id="fortran-90">Fortran 90</h3>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">ran_mod</span>
<span class="k">contains</span>
<span class="k">     function </span><span class="n">ran1</span><span class="p">(</span><span class="n">idum</span><span class="p">)</span>
        <span class="k">use </span><span class="n">numz</span>
        <span class="k">implicit none</span>  <span class="c">!note after use statement</span>
        <span class="kt">real</span> <span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">ran1</span>
        <span class="kt">integer</span> <span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span> <span class="k">optional</span> <span class="kd">::</span>  <span class="n">idum</span>
        <span class="kt">real</span> <span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">r</span><span class="p">(</span><span class="mi">97</span><span class="p">),</span><span class="n">rm1</span><span class="p">,</span><span class="n">rm2</span>
        <span class="kt">integer</span> <span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">m1</span><span class="o">=</span><span class="mi">259200</span><span class="p">,</span><span class="n">ia1</span><span class="o">=</span><span class="mi">7141</span><span class="p">,</span><span class="n">ic1</span><span class="o">=</span><span class="mi">54773</span>
        <span class="kt">integer</span> <span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">m2</span><span class="o">=</span><span class="mi">134456</span><span class="p">,</span><span class="n">ia2</span><span class="o">=</span><span class="mi">8121</span><span class="p">,</span><span class="n">ic2</span><span class="o">=</span><span class="mi">28411</span>
        <span class="kt">integer</span> <span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">m3</span><span class="o">=</span><span class="mi">243000</span><span class="p">,</span><span class="n">ia3</span><span class="o">=</span><span class="mi">4561</span><span class="p">,</span><span class="n">ic3</span><span class="o">=</span><span class="mi">51349</span>
        <span class="kt">integer </span><span class="n">j</span>
        <span class="kt">integer </span><span class="n">iff</span><span class="p">,</span><span class="n">ix1</span><span class="p">,</span><span class="n">ix2</span><span class="p">,</span><span class="n">ix3</span>
        <span class="k">data </span><span class="n">iff</span> <span class="o">/</span><span class="mi">0</span><span class="o">/</span>
        <span class="k">save</span> <span class="c">! corrects a bug in the original routine</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">idum</span><span class="p">))</span><span class="k">then</span>
<span class="k">          if</span> <span class="p">(</span><span class="n">idum</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mf">0.</span><span class="nb">or</span><span class="p">.</span><span class="n">iff</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<span class="k">            </span><span class="n">rm1</span><span class="o">=</span><span class="mf">1.0_b8</span> <span class="n">m1</span>
            <span class="n">rm2</span><span class="o">=</span><span class="mf">1.0_b8</span> <span class="n">m2</span>
            <span class="n">iff</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ic1</span><span class="o">-</span><span class="n">idum</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
            <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
            <span class="n">ix2</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
            <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
            <span class="n">ix3</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span>
            <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">97</span>
                <span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
                <span class="n">ix2</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia2</span><span class="o">*</span><span class="n">ix2</span><span class="o">+</span><span class="n">ic2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
                <span class="n">r</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">b8</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="n">ix2</span><span class="p">,</span><span class="n">b8</span><span class="p">)</span><span class="o">*</span><span class="n">rm2</span><span class="p">)</span><span class="o">*</span><span class="n">rm1</span>
            <span class="k">enddo</span>
<span class="k">            </span><span class="n">idum</span><span class="o">=</span><span class="mi">1</span>
          <span class="k">endif</span>
<span class="k">        endif</span>
<span class="k">        </span><span class="n">ix1</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia1</span><span class="o">*</span><span class="n">ix1</span><span class="o">+</span><span class="n">ic1</span><span class="p">,</span><span class="n">m1</span><span class="p">)</span>
        <span class="n">ix2</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia2</span><span class="o">*</span><span class="n">ix2</span><span class="o">+</span><span class="n">ic2</span><span class="p">,</span><span class="n">m2</span><span class="p">)</span>
        <span class="n">ix3</span><span class="o">=</span><span class="nb">mod</span><span class="p">(</span><span class="n">ia3</span><span class="o">*</span><span class="n">ix3</span><span class="o">+</span><span class="n">ic3</span><span class="p">,</span><span class="n">m3</span><span class="p">)</span>
        <span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">97</span><span class="o">*</span><span class="n">ix3</span><span class="p">)</span><span class="o">/</span><span class="n">m3</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">9</span><span class="mf">7.</span><span class="nb">or</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39; error in ran1 j=&#39;</span><span class="p">,</span><span class="n">j</span>
            <span class="k">stop</span>
<span class="k">        endif</span>
<span class="k">        </span><span class="n">ran1</span><span class="o">=</span><span class="n">r</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">r</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">ix1</span><span class="p">,</span><span class="n">b8</span><span class="p">)</span><span class="o">+</span><span class="kt">real</span><span class="p">(</span><span class="n">ix2</span><span class="p">,</span><span class="n">b8</span><span class="p">)</span><span class="o">*</span><span class="n">rm2</span><span class="p">)</span><span class="o">*</span><span class="n">rm1</span>
        <span class="k">return</span>
<span class="k">     end function </span><span class="n">ran1</span>
</code></pre></div>
<h2 id="comments">Comments</h2>
<ol>
<li>Modules are a way of encapsulating functions an data.  More below.</li>
<li>The <strong>use numz</strong> line is similar to an include file.  In this case it defines our real data type.</li>
<li><strong>real (b8)</strong>  is a new way to specify percision for data types in a portable way.</li>
<li><strong>integer , intent(inout), optional ::  idum</strong> we are saying idum is an optional input parameter</li>
<li><strong>integer , parameter ::</strong> just a different syntax</li>
<li>The <strong>save</strong> statement is needed for program correctness</li>
<li><strong>present(idum)</strong> is a function to determine if ran1 was called with the optional parameter</li>
</ol>
<hr />
<hr />
<h2 id="obsolescent-features">Obsolescent features</h2>
<p>The following are available in Fortran 90. On the other hand, the concept of "obsolescence" is introduced. This means that some constructs may be removed in the future.
- Arithmetic IF-statement
- Control variables in a DO-loop which are floating point or double-precision floating-point
- Terminating several DO-loops on the same statement
- Terminating the DO-loop in some other way than with CONTINUE or END DO
- Alternate return
- Jump to END IF from an outer block
- PAUSE
- ASSIGN and assigned GOTO and assigned FORMAT , that is the whole "statement number variable" concept.
- Hollerith editing in FORMAT.</p>
<hr />
<hr />
<h2 id="new-source-form-and-related-things">New source form and related things</h2>
<h3 id="summary">Summary</h3>
<ul>
<li>! now indicates the start of a comment</li>
<li>&amp; indicates the next line is a continuation</li>
<li>Lines can be longer than 72 characters</li>
<li>Statements can start in any column</li>
<li>Use ; to put multiple statements on one line</li>
<li>New forms for the do loop</li>
<li>Many functions are generic</li>
<li>32 character names</li>
<li>Many new array assignment techniques</li>
</ul>
<h3 id="features">Features</h3>
<ul>
<li>Flexibility can aid in program readability</li>
<li>Readability decreases errors</li>
<li>Got ya!<ul>
<li>Can no longer use C to start a comment</li>
<li>Character in column 5 no longer is continue</li>
<li>Tab is not a valid character (may produce a warning)</li>
<li>Characters past 72 now count</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">program </span><span class="n">darwin</span>
     <span class="kt">real </span><span class="n">a</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">b</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">d</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">e</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
     <span class="kt">integer </span><span class="n">odd</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="n">even</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c">! this line is continued by using &quot;&amp;&quot;</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;starting &quot;</span><span class="p">,&amp;</span>  
                <span class="s2">&quot;darwin&quot;</span> <span class="c">! this line in a continued from above</span>
<span class="c">! multiple statement per line --rarely a good idea</span>
     <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>  
     <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span>    <span class="c">! statement lable is not required for do</span>
        <span class="n">e</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">i</span>
     <span class="k">enddo</span>
<span class="k">     </span><span class="n">odd</span><span class="o">=</span> <span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span> <span class="o">/</span><span class="p">)</span>  <span class="c">! array assignment</span>
     <span class="n">even</span><span class="o">=</span><span class="p">(</span><span class="o">/</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span> <span class="o">/</span><span class="p">)</span> <span class="c">! array assignment</span>
     <span class="n">a</span><span class="o">=</span><span class="mi">1</span>          <span class="c">! array assignment, every element of a = 1</span>
     <span class="n">b</span><span class="o">=</span><span class="mi">2</span>
     <span class="n">c</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">e</span>      <span class="c">! element by element assignment</span>
     <span class="n">c</span><span class="p">(</span><span class="n">odd</span><span class="p">)</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">even</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>  <span class="c">! can use arrays of indices on both sides</span>
     <span class="n">d</span><span class="o">=</span><span class="nb">sin</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>     <span class="c">! element by element application of intrinsics</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">d</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>  <span class="c">! many intrinsic functions are generic</span>
 <span class="n">a_do_loop</span> <span class="p">:</span> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span>
               <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">i</span><span class="p">,</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">d</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
             <span class="k">enddo </span><span class="n">a_do_loop</span>
     <span class="k">do</span>
<span class="k">        if</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">.</span><span class="n">lt</span><span class="p">.</span> <span class="mf">0.0</span> <span class="p">)</span> <span class="k">exit</span>
<span class="k">        </span><span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
     <span class="k">enddo</span>
<span class="k">     write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
     <span class="k">do while</span> <span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">c</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
     <span class="k">enddo</span>
<span class="k">     write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">c</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="k">end program</span>
</code></pre></div>
<hr />
<hr />
<h2 id="new-data-declaration-method">New data declaration method</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>Variables can now have attributes such as
        - Parameter
            - Save
            - Dimension</li>
<li>Attributes are assigned in the variable declaration statement</li>
</ul>
</li>
<li>
<p>One variable can have several attributes</p>
</li>
<li>Requires Fortran 90 to have a new statement form</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">in2</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="kt">real</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.141592653589793239</span>
    <span class="kt">real</span><span class="p">,</span> <span class="k">save</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">cpu_times</span><span class="p">,</span><span class="n">wall_times</span>
<span class="c">!****    the old way of doing the same    ****!</span>
<span class="c">!****    real cpu_times(10),wall_times(10) ****!</span>
<span class="c">!****    save cpu_times, wall_times        ****!</span>
</code></pre></div>
- Other Attributes
    -  allocatable
    -  public
    -  private
    -  target
    -  pointer
    -  intent
    -  optional</p>
<hr />
<hr />
<h2 id="kind-facility">Kind facility</h2>
<ul>
<li>Motivation<ul>
<li>Assume we have a program that we want to run on two different machines</li>
<li>We want the same representation of reals on both machines (same number
    of significant digits)</li>
<li>Problem: different machines have different representations for reals</li>
</ul>
</li>
</ul>
<h3 id="digits-of-precision-for-some-old-machines-and-data-type">Digits of precision for some (old) machines and data type</h3>
<table>
<thead>
<tr>
<th align="left">Machine</th>
<th align="left">Real</th>
<th align="left">Double Precision</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">IBM (SP)</td>
<td align="left">6</td>
<td align="left">15</td>
</tr>
<tr>
<td align="left">Cray (T90)</td>
<td align="left">15</td>
<td align="left">33</td>
</tr>
<tr>
<td align="left">Cray (T3E)</td>
<td align="left">15</td>
<td align="left">15</td>
</tr>
</tbody>
</table>
<h3 id="or"><strong><em>*</em></strong><strong> or </strong><strong><em>*</em></strong></h3>
<ul>
<li>We may want to run with at least 6 digits today and at least 14 digits tomorrow</li>
<li>Use the Select_Real_Kind(P) function to create a data type with P digits of precision</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">program </span><span class="n">darwin</span>
<span class="c">! e has at least 4 significant digits</span>
  <span class="kt">real</span><span class="p">(</span><span class="nb">selected_real_kind</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="n">e</span>
<span class="c">! b8 will be used to define reals with 14 digits</span>
  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">b8</span> <span class="o">=</span> <span class="nb">selected_real_kind</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.141592653589793239_b8</span> <span class="c">! note usage of _b8</span>
<span class="c">! with  a constant</span>
<span class="c">! to force precision</span>
 <span class="n">e</span><span class="o">=</span> <span class="mf">2.71828182845904523536</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;starting &quot;</span><span class="p">,&amp;</span>  <span class="c">! this line is continued by using &quot;&amp;&quot;</span>
            <span class="s2">&quot;darwin&quot;</span>       <span class="c">! this line in a continued from above</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;pi has &quot;</span><span class="p">,</span><span class="nb">precision</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span><span class="s2">&quot; digits precision &quot;</span><span class="p">,</span><span class="n">pi</span>
  <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;e has   &quot;</span><span class="p">,</span><span class="nb">precision</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="s2">&quot; digits precision &quot;</span><span class="p">,</span><span class="n">e</span>
<span class="k">end program</span>
</code></pre></div>
<h3 id="example-output">Example output</h3>
<div class="highlight"><pre><span></span><code>  sp001  % darwin
 starting darwin
 pi has  15  digits precision  3.14159265358979312
 e has    6  digits precision  2.718281746
sp001 %
</code></pre></div>
<ul>
<li>Can convert to/from given precision for all variables created using "b8" by changing definition of "b8"</li>
<li>Use the Select_Real_Kind(P,R) function to create a data type with P digits of precision and exponent range of R</li>
</ul>
<hr />
<hr />
<h2 id="modules">Modules</h2>
<ul>
<li>
<p>Motivation:</p>
<ul>
<li>Common block usage is prone to error</li>
<li>Provide most of capability of common blocks but safer</li>
<li>Provide capabilities beyond common blocks</li>
</ul>
</li>
<li>
<p>Modules can contain:</p>
<ul>
<li>Data definitions</li>
<li>Data to be shared much like using a labeled common</li>
<li>Functions and subroutines</li>
<li>Interfaces (more on this later)</li>
</ul>
</li>
<li>
<p>You "include" a module with a "use" statement</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">numz</span>
  <span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="kd">::</span> <span class="n">b8</span> <span class="o">=</span> <span class="nb">selected_real_kind</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
  <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.141592653589793239_b8</span>
  <span class="n">integergene_size</span>
<span class="k">end module</span>
<span class="k"> program </span><span class="n">darwin</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">implicit none</span>    <span class="c">! now part of the standard, put it after the use statements</span>
   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;pi has &quot;</span><span class="p">,</span><span class="nb">precision</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span><span class="s2">&quot;</span>
<span class="s2">digits precision &quot;</span><span class="p">,</span><span class="n">pi</span>
   <span class="k">call </span><span class="n">set_size</span><span class="p">()</span>
   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;gene_size=&quot;</span><span class="p">,</span><span class="n">gene_size</span>
 <span class="k">end program</span>
<span class="k">subroutine </span><span class="n">set_size</span>
  <span class="k">use </span><span class="n">numz</span>
  <span class="n">gene_size</span><span class="o">=</span><span class="mi">10</span>
<span class="k">end subroutine</span>
</code></pre></div>
<h3 id="an-example-run">An example run</h3>
<div class="highlight"><pre><span></span><code>  pi has  15  digits precision  3.14159265358979312
  gene_size=10
</code></pre></div>
<hr />
<hr />
<h2 id="module-functions-and-subroutines">Module functions and subroutines</h2>
<ul>
<li>
<p>Motivation:</p>
<ul>
<li>Encapsulate related functions and subroutines</li>
<li>Can "USE" these functions in a program or subroutine</li>
<li>Can be provided as a library</li>
<li>Only routines that contain the use statement can see the routines</li>
</ul>
</li>
<li>
<p>Example is a random number package:
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">ran_mod</span>
<span class="c">! module contains three functions</span>
<span class="c">! ran1 returns a uniform random number between 0-1</span>
<span class="c">! spread returns random number between min - max</span>
<span class="c">! normal returns a normal distribution</span>
<span class="k">contains</span>
<span class="k">    function </span><span class="n">ran1</span><span class="p">()</span>  <span class="c">!returns random number between 0 - 1</span>
        <span class="k">use </span><span class="n">numz</span>
        <span class="k">implicit none</span>
<span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">ran1</span><span class="p">,</span><span class="n">x</span>
        <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c">! built in fortran 90 random number function</span>
        <span class="n">ran1</span><span class="o">=</span><span class="n">x</span>
    <span class="k">end function </span><span class="n">ran1</span>
    <span class="k">function </span><span class="nb">spread</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">)</span>  <span class="c">!returns random # between min/max</span>
        <span class="k">use </span><span class="n">numz</span>
        <span class="k">implicit none</span>
<span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="nb">spread</span>
<span class="nb">        </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="nb">min</span><span class="p">,</span><span class="nb">max</span>
<span class="nb">        spread</span><span class="o">=</span><span class="p">(</span><span class="nb">max</span> <span class="o">-</span> <span class="nb">min</span><span class="p">)</span> <span class="o">*</span> <span class="n">ran1</span><span class="p">()</span> <span class="o">+</span> <span class="nb">min</span>
<span class="nb">    </span><span class="k">end function </span><span class="nb">spread</span>
<span class="nb">    </span><span class="k">function </span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span> <span class="c">!returns a normal distribution</span>
        <span class="k">use </span><span class="n">numz</span>
        <span class="k">implicit none</span>
<span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">normal</span><span class="p">,</span><span class="n">tmp</span>
        <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">mean</span><span class="p">,</span><span class="n">sigma</span>
        <span class="kt">integer </span><span class="n">flag</span>
        <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">fac</span><span class="p">,</span><span class="n">gsave</span><span class="p">,</span><span class="n">rsq</span><span class="p">,</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span>
        <span class="k">save </span><span class="n">flag</span><span class="p">,</span><span class="n">gsave</span>
        <span class="k">data </span><span class="n">flag</span> <span class="o">/</span><span class="mi">0</span><span class="o">/</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">rsq</span><span class="o">=</span><span class="mf">2.0_b8</span>
            <span class="k">do while</span><span class="p">(</span><span class="n">rsq</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mf">1.0_b8</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">rsq</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.0_b8</span><span class="p">)</span> <span class="c">! new from for do</span>
                <span class="n">r1</span><span class="o">=</span><span class="mf">2.0_b8</span><span class="o">*</span><span class="n">ran1</span><span class="p">()</span><span class="o">-</span><span class="mf">1.0_b8</span>
                <span class="n">r2</span><span class="o">=</span><span class="mf">2.0_b8</span><span class="o">*</span><span class="n">ran1</span><span class="p">()</span><span class="o">-</span><span class="mf">1.0_b8</span>
                <span class="n">rsq</span><span class="o">=</span><span class="n">r1</span><span class="o">*</span><span class="n">r1</span><span class="o">+</span><span class="n">r2</span><span class="o">*</span><span class="n">r2</span>
            <span class="k">enddo</span>
<span class="k">            </span><span class="n">fac</span><span class="o">=</span><span class="nb">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0_b8</span><span class="o">*</span><span class="nb">log</span><span class="p">(</span><span class="n">rsq</span><span class="p">)</span><span class="o">/</span><span class="n">rsq</span><span class="p">)</span>
            <span class="n">gsave</span><span class="o">=</span><span class="n">r1</span><span class="o">*</span><span class="n">fac</span>
            <span class="n">tmp</span><span class="o">=</span><span class="n">r2</span><span class="o">*</span><span class="n">fac</span>
            <span class="n">flag</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">tmp</span><span class="o">=</span><span class="n">gsave</span>
            <span class="n">flag</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">endif</span>
<span class="k">        </span><span class="n">normal</span><span class="o">=</span><span class="n">tmp</span><span class="o">*</span><span class="n">sigma</span><span class="o">+</span><span class="n">mean</span>
        <span class="k">return</span>
<span class="k">    end function </span><span class="n">normal</span> <span class="k">end module </span><span class="n">ran_mod</span>
</code></pre></div></p>
</li>
</ul>
<hr />
<hr />
<p>Exersize 1:  Write a program that returns 10 uniform random numbers.</p>
<hr />
<hr />
<h2 id="allocatable-arrays-the-basics">Allocatable arrays (the basics)</h2>
<ul>
<li>
<p>Motivation:</p>
<ul>
<li>At compile time we may not know the size an array needs to be</li>
<li>We may want to change problem size without recompiling</li>
</ul>
</li>
<li>
<p>Allocatable arrays allow us to set the size at run time</p>
</li>
<li>We set the size of the array using the allocate statement</li>
<li>We may want to change the lower bound for an array</li>
<li>A simple example:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">numz</span>
  <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">b8</span> <span class="o">=</span> <span class="nb">selected_real_kind</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
  <span class="kt">integer </span><span class="n">gene_size</span><span class="p">,</span><span class="n">num_genes</span>
  <span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">a_gene</span><span class="p">(:),</span><span class="n">many_genes</span><span class="p">(:,:)</span>
<span class="k">end module</span>
<span class="k">program </span><span class="n">darwin</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">integer </span><span class="n">ierr</span>
    <span class="k">call </span><span class="n">set_size</span><span class="p">()</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">a_gene</span><span class="p">(</span><span class="n">gene_size</span><span class="p">),</span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span> <span class="c">!stat= allows for an error code return</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;allocation error&quot;</span>  <span class="c">! /= is .ne.</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">many_genes</span><span class="p">(</span><span class="n">gene_size</span><span class="p">,</span><span class="n">num_genes</span><span class="p">),</span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span>  <span class="c">!2d array</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;allocation error&quot;</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">lbound</span><span class="p">(</span><span class="n">a_gene</span><span class="p">),</span><span class="nb">ubound</span><span class="p">(</span><span class="n">a_gene</span><span class="p">)</span> <span class="c">! get lower and upper bound</span>
                                            <span class="c">! for the array</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">size</span><span class="p">(</span><span class="n">many_genes</span><span class="p">),</span><span class="n">size</span><span class="p">(</span><span class="n">many_genes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c">!get total size and size</span>
                                                  <span class="c">!along 1st dimension</span>
    <span class="k">deallocate</span><span class="p">(</span><span class="n">many_genes</span><span class="p">)</span> <span class="c">! free the space for the array and matrix</span>
    <span class="k">deallocate</span><span class="p">(</span><span class="n">a_gene</span><span class="p">)</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">a_gene</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">gene_size</span><span class="p">))</span> <span class="c">! now allocate starting at 0 instead of 1</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">allocated</span><span class="p">(</span><span class="n">many_genes</span><span class="p">),</span><span class="nb">allocated</span><span class="p">(</span><span class="n">a_gene</span><span class="p">)</span> <span class="c">! shows if allocated</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">lbound</span><span class="p">(</span><span class="n">a_gene</span><span class="p">),</span><span class="nb">ubound</span><span class="p">(</span><span class="n">a_gene</span><span class="p">)</span>
<span class="k">end program</span>
<span class="k">  subroutine </span><span class="n">set_size</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;enter gene size:&#39;</span>
    <span class="k">read</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">gene_size</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;enter number of genes:&#39;</span>
    <span class="k">read</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">num_genes</span>
<span class="k">end subroutine </span><span class="n">set_size</span>
</code></pre></div>
<h2 id="example-run">Example run</h2>
<div class="highlight"><pre><span></span><code>    enter gene size:
10
 enter number of genes:
20
           1          10
         200          10
 F T
           0          10
</code></pre></div>
<h2 id="passing-arrays-to-subroutines">Passing arrays to subroutines</h2>
<ul>
<li>There are several ways to specify arrays for subroutines<ul>
<li>Explicit shape<ul>
<li>integer, dimension(8,8)::an_explicit_shape_array</li>
</ul>
</li>
<li>Assumed size<ul>
<li>integer, dimension(i,*)::an_assumed_size_array</li>
</ul>
</li>
<li>Assumed Shape<ul>
<li>integer, dimension(:,:)::an_assumed_shape_array</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="example">Example</h3>
<div class="highlight"><pre><span></span><code><span class="k">subroutine </span><span class="n">arrays</span><span class="p">(</span><span class="n">an_explicit_shape_array</span><span class="p">,&amp;</span>
                  <span class="n">i</span>                      <span class="p">,&amp;</span> <span class="c">!note we pass all bounds except the last</span>
                  <span class="n">an_assumed_size_array</span>  <span class="p">,&amp;</span>
                  <span class="n">an_assumed_shape_array</span><span class="p">)</span>
<span class="c">! Explicit shape</span>
    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span><span class="kd">::</span><span class="n">an_explicit_shape_array</span>
<span class="c">! Assumed size</span>
    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="kd">::</span><span class="n">an_assumed_size_array</span>
<span class="c">! Assumed Shape</span>
    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:,:)</span><span class="kd">::</span><span class="n">an_assumed_shape_array</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">sum</span><span class="p">(</span><span class="n">an_explicit_shape_array</span><span class="p">)</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">lbound</span><span class="p">(</span><span class="n">an_assumed_size_array</span><span class="p">)</span> <span class="c">! why does sum not work here?</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">sum</span><span class="p">(</span><span class="n">an_assumed_shape_array</span><span class="p">)</span>
<span class="k">end subroutine</span>
</code></pre></div>
<hr />
<hr />
<h2 id="interface-for-passing-arrays">Interface for passing arrays</h2>
<ul>
<li><strong>!!!!Warning!!!!  When passing assumed shape arrays as arguments you must provide an interface</strong></li>
<li>Similar to C prototypes but much more versatile</li>
<li>The interface is a copy of the invocation line and the argument definitions</li>
<li>Modules are a good place for interfaces</li>
<li>If a procedure is part of a "contains" section in a module an interface
    is not required</li>
<li><strong>!!!!Warning!!!! The compiler may not tell you that you need an interface</strong>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">numz</span>
    <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">b8</span> <span class="o">=</span> <span class="nb">selected_real_kind</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">a_gene</span><span class="p">(:),</span><span class="n">many_genes</span><span class="p">(:,:)</span>
<span class="k">end module module </span><span class="n">face</span>
    <span class="k">interface </span><span class="n">fitness</span>
        <span class="k">function </span><span class="n">fitness</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="k">use </span><span class="n">numz</span>
        <span class="k">implicit none</span>
<span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">fitness</span>
        <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span>  <span class="n">vector</span>
        <span class="k">end function </span><span class="n">fitness</span>
    <span class="k">end interface</span>
<span class="k">end module program </span><span class="n">darwin</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">use </span><span class="n">face</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">integer </span><span class="n">i</span>
    <span class="kt">integer </span><span class="n">vect</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c">! just a regular array</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">a_gene</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span><span class="k">allocate</span><span class="p">(</span><span class="n">many_genes</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">a_gene</span><span class="o">=</span><span class="mi">1</span>  <span class="c">!sets every element of a_gene to 1</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">fitness</span><span class="p">(</span><span class="n">a_gene</span><span class="p">)</span>
    <span class="n">vect</span><span class="o">=</span><span class="mi">8</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">fitness</span><span class="p">(</span><span class="n">vect</span><span class="p">)</span> <span class="c">! also works with regular arrays</span>
    <span class="n">many_genes</span><span class="o">=</span><span class="mi">3</span>  <span class="c">!sets every element to 3</span>
    <span class="n">many_genes</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">=</span><span class="n">a_gene</span>  <span class="c">!sets column 1 to a_gene</span>
    <span class="n">many_genes</span><span class="p">(</span><span class="mi">2</span><span class="p">,:)</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">many_genes</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span>
    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
        <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">fitness</span><span class="p">(</span><span class="n">many_genes</span><span class="p">(</span><span class="n">i</span><span class="p">,:))</span>
    <span class="k">enddo</span>
<span class="k">    write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">fitness</span><span class="p">(</span><span class="n">many_genes</span><span class="p">(:,</span><span class="mi">1</span><span class="p">))</span>  <span class="c">!go along other dimension</span>
<span class="c">!!!!write(*,*)fitness(many_genes)!!!!does not work</span>
<span class="k">end program</span>
<span class="k">function </span><span class="n">fitness</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">fitness</span>
    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span><span class="kd">::</span>  <span class="n">vector</span> <span class="c">! must match interface</span>
    <span class="n">fitness</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
<span class="k">end function</span>
</code></pre></div></li>
</ul>
<hr />
<hr />
<p>Exersize 2:  Run this program using the "does not work line".
Why?  Using intrinsic functions make it work?</p>
<p>Exersize 3:  Prove that f90 does not "pass by address".</p>
<hr />
<hr />
<h2 id="optional-arguments-and-intent">Optional arguments and intent</h2>
<ul>
<li>Motivation:<ul>
<li>We may have a function or subroutine that we may not want to always pass
    all arguments</li>
<li>Initialization</li>
</ul>
</li>
<li>Two examples<ul>
<li>Seeding the intrinsic random number generator requires keyword arguments</li>
<li>To define an optional argument in our own function we use the optional
    attribute</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>integer :: my_seed
</code></pre></div>
<h3 id="becomes">becomes</h3>
<div class="highlight"><pre><span></span><code>integer, optional :: my_seed
</code></pre></div>
<p>Used like this:</p>
<div class="highlight"><pre><span></span><code><span class="c">! ran1 returns a uniform random number between 0-1</span>
<span class="c">! the seed is optional and used to reset the generator</span>
<span class="k">contains</span>
<span class="k">   function </span><span class="n">ran1</span><span class="p">(</span><span class="n">my_seed</span><span class="p">)</span>
      <span class="k">use </span><span class="n">numz</span>
      <span class="k">implicit none</span>
<span class="k">      </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">ran1</span><span class="p">,</span><span class="n">r</span>
      <span class="kt">integer</span><span class="p">,</span> <span class="k">optional</span> <span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">my_seed</span>  <span class="c">! optional argument not changed in the routine</span>
      <span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">seed</span><span class="p">(:)</span>
      <span class="kt">integer </span><span class="n">the_size</span><span class="p">,</span><span class="n">j</span>
      <span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">my_seed</span><span class="p">))</span><span class="k">then</span>            <span class="c">! use the seed if present</span>
          <span class="k">call </span><span class="nb">random_seed</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">the_size</span><span class="p">)</span> <span class="c">! how big is the intrisic seed?</span>
          <span class="k">allocate</span><span class="p">(</span><span class="n">seed</span><span class="p">(</span><span class="n">the_size</span><span class="p">))</span>        <span class="c">! allocate space for seed</span>
          <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">the_size</span>                 <span class="c">! create the seed</span>
             <span class="n">seed</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">my_seed</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c">! abs is generic</span>
          <span class="k">enddo</span>
<span class="k">          call </span><span class="nb">random_seed</span><span class="p">(</span><span class="n">put</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>      <span class="c">! assign the seed</span>
          <span class="k">deallocate</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>                <span class="c">! deallocate space</span>
      <span class="k">endif</span>
<span class="k">      call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
      <span class="n">ran1</span><span class="o">=</span><span class="n">r</span>
  <span class="k">end function </span><span class="n">ran1</span>
<span class="k">end module program </span><span class="n">darwin</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">use </span><span class="n">ran_mod</span>          <span class="c">! interface required if we have</span>
                         <span class="c">! optional or intent arguments</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
    <span class="n">x</span><span class="o">=</span><span class="n">ran1</span><span class="p">(</span><span class="n">my_seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span> <span class="c">! we can specify the name of the argument</span>
    <span class="n">y</span><span class="o">=</span><span class="n">ran1</span><span class="p">()</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
    <span class="n">x</span><span class="o">=</span><span class="n">ran1</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>         <span class="c">! with only one optional argument we don&#39;t need to</span>
    <span class="n">y</span><span class="o">=</span><span class="n">ran1</span><span class="p">()</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
<span class="k">end program</span>
</code></pre></div>
<ul>
<li>Intent is a hint to the compiler to enable optimization<ul>
<li>intent(in)<ul>
<li>We will not change this value in our subroutine</li>
</ul>
</li>
<li>intent(out)<ul>
<li>We will define this value in our routine</li>
</ul>
</li>
<li>intent(inout)<ul>
<li>The normal situation</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="derived-data-types">Derived data types</h2>
<ul>
<li>
<p>Motivation:</p>
<ul>
<li>Derived data types can be used to group different types of data together
    (integers, reals, character, complex)</li>
<li>Can not be done in F77 although people have "faked" it</li>
</ul>
</li>
<li>
<p>Example</p>
<ul>
<li>In our GA we define a collection of genes as a 2d array</li>
<li>We call the fitness function for every member of the collection</li>
<li>We want to sort the collection of genes based on result of fitness function</li>
<li>Define a data type that holds the fitness value and an index into the 2d
    array</li>
<li>Create an array of this data type, 1 for each member of the collection</li>
<li>Call fitness function with the result being placed into the new data type
    along with a pointer into the array</li>
</ul>
</li>
<li>Again modules are a good place for data type definitions</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">galapagos</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">type </span><span class="n">thefit</span> <span class="c">!the name of the type</span>
      <span class="k">sequence</span>  <span class="c">! sequence forces the data elements</span>
                <span class="c">! to be next to each other in memory</span>
                <span class="c">! where might this be useful?</span>
      <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">val</span>   <span class="c">! our result from the fitness function</span>
      <span class="kt">integer </span><span class="nb">index</span>  <span class="c">! the index into our collection of genes</span>
    <span class="k">end type </span><span class="n">thefit</span>
<span class="k">end module</span>
</code></pre></div>
<hr />
<hr />
<h2 id="using-defined-types">Using defined types</h2>
<ul>
<li>Use the % to reference various components of the derived data type
<div class="highlight"><pre><span></span><code><span class="k">program </span><span class="n">darwin</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">use </span><span class="n">galapagos</span> <span class="c">! the module that contains the type definition</span>
    <span class="k">use </span><span class="n">face</span>      <span class="c">! contains various interfaces</span>
 <span class="k">implicit none</span>
<span class="c">! define an allocatable array of the data type</span>
<span class="c">! than contains an index and a real value</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">),</span><span class="k">allocatable</span> <span class="p">,</span><span class="k">target</span>  <span class="kd">::</span> <span class="n">results</span><span class="p">(:)</span>
<span class="c">! create a single instance of the data type</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">)</span> <span class="n">best</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">genes</span><span class="p">(:,:)</span> <span class="c">! our genes for the genetic algorithm</span>
    <span class="kt">integer </span><span class="n">j</span>
    <span class="kt">integer </span><span class="n">num_genes</span><span class="p">,</span><span class="n">gene_size</span>
    <span class="n">num_genes</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">gene_size</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">results</span><span class="p">(</span><span class="n">num_genes</span><span class="p">))</span>         <span class="c">! allocate the data type</span>
                                         <span class="c">! to hold fitness and index</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">genes</span><span class="p">(</span><span class="n">num_genes</span><span class="p">,</span><span class="n">gene_size</span><span class="p">))</span> <span class="c">! allocate our collection of genes</span>
    <span class="k">call </span><span class="n">init_genes</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span>               <span class="c">! starting data</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(&quot;input&quot;)&#39;</span> <span class="p">)</span> <span class="c">! we can put format in write statement</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_genes</span>
       <span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="nb">index</span> <span class="o">=</span><span class="n">j</span>
       <span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">val</span> <span class="o">=</span><span class="n">fitness</span><span class="p">(</span><span class="n">genes</span><span class="p">(</span><span class="n">j</span><span class="p">,:))</span> <span class="c">! just a dummy routine for now</span>
       <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;(f10.8,i4)&quot;</span><span class="p">)</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">val</span><span class="p">,</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="nb">index</span>
<span class="nb">    </span><span class="k">enddo</span>
<span class="k">end program</span>
</code></pre></div></li>
</ul>
<hr />
<hr />
<h2 id="user-defined-operators">User defined operators</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>With derived data types we may want (need) to define operations</li>
<li>(Assignment is predefined)</li>
</ul>
</li>
<li>
<p>Example:</p>
<ul>
<li>.lt. .gt. ==  not defined for our data types
        -  We want to find the minimum of our fitness values so we need &lt; operator
        -  In our sort routine we want to do &lt;, &gt;, ==
        -  In C++ terms the operators are overloaded</li>
<li>We are free to define new operators</li>
</ul>
</li>
<li>
<p>Two step process to define operators</p>
<ul>
<li>Define a special interface</li>
<li>Define the function that performs the operation
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">sort_mod</span>
<span class="c">!defining the interfaces</span>
  <span class="k">interface </span><span class="n">operator</span> <span class="p">(.</span><span class="n">lt</span><span class="p">.)</span>  <span class="c">! overloads standard .lt.</span>
    <span class="k">module procedure </span><span class="n">theless</span> <span class="c">! the function that does it</span>
  <span class="k">end interface   interface </span><span class="n">operator</span> <span class="p">(.</span><span class="n">gt</span><span class="p">.)</span>   <span class="c">! overloads standard .gt.</span>
    <span class="k">module procedure </span><span class="n">thegreat</span> <span class="c">! the function that does it</span>
  <span class="k">end interface   interface </span><span class="n">operator</span> <span class="p">(.</span><span class="n">ge</span><span class="p">.)</span>  <span class="c">! overloads standard .ge.</span>
    <span class="k">module procedure </span><span class="n">thetest</span> <span class="c">! the function that does it</span>
  <span class="k">end interface   interface </span><span class="n">operator</span> <span class="p">(.</span><span class="n">converged</span><span class="p">.)</span>  <span class="c">! new operator</span>
    <span class="k">module procedure </span><span class="n">index_test</span>     <span class="c">! the function that does it</span>
  <span class="k">end interface</span>
<span class="k">  contains</span>      <span class="c">! our module will contain</span>
              <span class="c">! the required functions</span>
    <span class="k">function </span><span class="n">theless</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="c">! overloads .lt. for the type (thefit)</span>
    <span class="k">use </span><span class="n">galapagos</span>
    <span class="k">implicit none</span>
<span class="k">    type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
    <span class="kt">logical </span><span class="n">theless</span>           <span class="c">! what we return</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">val</span> <span class="p">.</span><span class="n">lt</span><span class="p">.</span> <span class="n">b</span><span class="p">%</span><span class="n">val</span><span class="p">)</span><span class="k">then</span>     <span class="c">! this is where we do the test</span>
        <span class="n">theless</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">theless</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">endif</span>
<span class="k">    return</span>
<span class="k">  end function </span><span class="n">theless</span>   <span class="k">function </span><span class="n">thegreat</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="c">! overloads .gt. for the type (thefit)</span>
    <span class="k">use </span><span class="n">galapagos</span>
    <span class="k">implicit none</span>
<span class="k">    type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
    <span class="kt">logical </span><span class="n">thegreat</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">val</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="n">b</span><span class="p">%</span><span class="n">val</span><span class="p">)</span><span class="k">then</span>
<span class="k">        </span><span class="n">thegreat</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">thegreat</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">endif</span>
<span class="k">    return</span>
<span class="k">  end function </span><span class="n">thegreat</span>
  <span class="k">function </span><span class="n">thetest</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>   <span class="c">! overloads .gt.= for the type (thefit)</span>
    <span class="k">use </span><span class="n">galapagos</span>
    <span class="k">implicit none</span>
<span class="k">    type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
    <span class="kt">logical </span><span class="n">thetest</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">%</span><span class="n">val</span><span class="p">)</span><span class="k">then</span>
<span class="k">        </span><span class="n">thetest</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">thetest</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">endif</span>
<span class="k">    return</span>
<span class="k">end function </span><span class="n">thetest</span>
  <span class="k">function </span><span class="n">index_test</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="c">! defines a new operation for the type (thefit)</span>
    <span class="k">use </span><span class="n">galapagos</span>
    <span class="k">implicit none</span>
<span class="k">    type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span> <span class="k">intent</span> <span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
    <span class="kt">logical </span><span class="n">index_test</span>
    <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="nb">index</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="n">b</span><span class="p">%</span><span class="nb">index</span><span class="p">)</span><span class="k">then</span>   <span class="c">! check the index value for a difference</span>
        <span class="n">index_test</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">index_test</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">endif</span>
<span class="k">    return</span>
<span class="k">end function </span><span class="n">index_test</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="recursive-functions-introduction">Recursive functions introduction</h2>
<ul>
<li>
<p>Notes</p>
<ul>
<li>Recursive function is one that calls itself</li>
<li>Anything that can be done with a do loop can be done using a recursive
    function</li>
</ul>
</li>
<li>
<p>Motivation</p>
<ul>
<li>Sometimes it is easier to think recursively</li>
<li>Divide an conquer algorithms are recursive by nature
        -  Fast FFTs
            -  Searching
            -  Sorting</li>
</ul>
</li>
</ul>
<h3 id="algorithm-of-searching-for-minimum-of-an-array">Algorithm of searching for minimum of an array</h3>
<div class="highlight"><pre><span></span><code>    <span class="k">function </span><span class="n">findmin</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
        <span class="k">is </span><span class="n">size</span> <span class="n">of</span> <span class="k">array </span><span class="mi">1</span><span class="err">?</span>
           <span class="nb">min </span><span class="n">in</span> <span class="n">the</span> <span class="k">array is </span><span class="n">first</span> <span class="n">element</span>
        <span class="k">else</span>
<span class="k">           </span><span class="n">find</span> <span class="n">minimum</span> <span class="n">in</span> <span class="n">left</span> <span class="n">half</span> <span class="n">of</span> <span class="k">array </span><span class="n">using</span> <span class="n">findmin</span> <span class="k">function</span>
<span class="k">           </span><span class="n">find</span> <span class="n">minimum</span> <span class="n">in</span> <span class="n">right</span> <span class="n">half</span> <span class="n">of</span> <span class="k">array </span><span class="n">using</span> <span class="n">findmin</span> <span class="k">function</span>
<span class="k">           </span><span class="n">global</span> <span class="n">minimum</span> <span class="k">is </span><span class="nb">min </span><span class="n">of</span> <span class="n">left</span> <span class="nb">and </span><span class="n">right</span> <span class="n">half</span>
    <span class="k">end function</span>
</code></pre></div>
<hr />
<hr />
<h2 id="fortran-90-recursive-functions">Fortran 90 recursive functions</h2>
<ul>
<li>Recursive functions should have an interface</li>
<li>The result and recursive keywords are required as part of the function definition</li>
<li>Example is a function finds the minimum value for an array</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">recursive function </span><span class="n">realmin</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">themin</span><span class="p">)</span>
<span class="c">! recursive and result are required for recursive functions</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">themin</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span>
    <span class="kt">integer </span><span class="n">n</span><span class="p">,</span><span class="n">right</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="p">,</span><span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">ain</span>
    <span class="n">n</span><span class="o">=</span><span class="n">size</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<span class="k">       </span><span class="n">themin</span><span class="o">=</span><span class="n">ain</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">! if the size is 1 return value</span>
    <span class="k">return</span>
<span class="k">    else</span>
<span class="k">      </span><span class="n">right</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span>
      <span class="n">t1</span><span class="o">=</span><span class="n">realmin</span><span class="p">(</span><span class="n">ain</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">right</span><span class="p">))</span>   <span class="c">! find min in left half</span>
      <span class="n">t2</span><span class="o">=</span><span class="n">realmin</span><span class="p">(</span><span class="n">ain</span><span class="p">(</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">))</span> <span class="c">! find min in right half</span>
      <span class="n">themin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>          <span class="c">! find min of the two sides</span>
     <span class="k">endif</span>
<span class="k">end function</span>
</code></pre></div>
<ul>
<li>Example 2 is the same except the input data is our derived data type</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">!this routine works with the data structure thefit not reals</span>
<span class="k">recursive function </span><span class="n">typemin</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">themin</span><span class="p">)</span>
    <span class="k">use </span><span class="n">numz</span>
 <span class="k">use </span><span class="n">sort_mod</span>
 <span class="k">use </span><span class="n">galapagos</span>
 <span class="k">implicit none</span>
<span class="k"> </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">themin</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span>
 <span class="kt">integer </span><span class="n">n</span><span class="p">,</span><span class="n">right</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">)</span> <span class="p">,</span><span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">ain</span> <span class="c">! this line is different</span>
 <span class="n">n</span><span class="o">=</span><span class="n">size</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span>
 <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<span class="k">     </span><span class="n">themin</span><span class="o">=</span><span class="n">ain</span><span class="p">(</span><span class="mi">1</span><span class="p">)%</span><span class="n">val</span>  <span class="c">! this line is different</span>
  <span class="k">return</span>
<span class="k"> else</span>
<span class="k">  </span><span class="n">right</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">t1</span><span class="o">=</span><span class="n">typemin</span><span class="p">(</span><span class="n">ain</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">right</span><span class="p">))</span>
  <span class="n">t2</span><span class="o">=</span><span class="n">typemin</span><span class="p">(</span><span class="n">ain</span><span class="p">(</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">))</span>
  <span class="n">themin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span>
 <span class="k">endif</span>
<span class="k">end function</span>
</code></pre></div>
<hr />
<hr />
<h2 id="pointers">Pointers</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>Can increase performance</li>
<li>Can improve readability</li>
<li>Required for some derived data types (linked lists and trees)</li>
<li>Useful for allocating "arrays" within subroutines</li>
<li>Useful for referencing sections of arrays</li>
</ul>
</li>
<li>
<p>Notes</p>
<ul>
<li>Pointers can be thought of as an alias to another variable</li>
<li>In some cases can be used in place of an array</li>
<li>To assign a pointer use =&gt; instead of just =</li>
<li>Unlike C and C++, pointer arithmetic is not allowed</li>
</ul>
</li>
<li>
<p>First pointer example</p>
<ul>
<li>Similar to the last findmin routine</li>
<li>Return a pointer to the minimum</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">recursive function </span><span class="n">pntmin</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">themin</span><span class="p">)</span> <span class="c">! return a pointer</span>
 <span class="k">use </span><span class="n">numz</span>
 <span class="k">use </span><span class="n">galapagos</span>
 <span class="k">use </span><span class="n">sort_mod</span> <span class="c">! contains the .lt. operator for thefit type</span>
 <span class="k">implicit none</span>
<span class="k"> type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">),</span><span class="k">pointer</span><span class="kd">::</span> <span class="n">themin</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span>
 <span class="kt">integer </span><span class="n">n</span><span class="p">,</span><span class="n">right</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">)</span> <span class="p">,</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">target</span> <span class="kd">::</span> <span class="n">ain</span>
 <span class="n">n</span><span class="o">=</span><span class="n">size</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span>
 <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<span class="k">     </span><span class="n">themin</span><span class="o">=&gt;</span><span class="n">ain</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">!this is how we do pointer assignment</span>
  <span class="k">return</span>
<span class="k"> else</span>
<span class="k">  </span><span class="n">right</span><span class="o">=</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span>
  <span class="n">t1</span><span class="o">=&gt;</span><span class="n">pntmin</span><span class="p">(</span><span class="n">ain</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">right</span><span class="p">))</span>
  <span class="n">t2</span><span class="o">=&gt;</span><span class="n">pntmin</span><span class="p">(</span><span class="n">ain</span><span class="p">(</span><span class="n">right</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">))</span>
  <span class="k">if</span><span class="p">(</span><span class="n">t1</span> <span class="p">.</span><span class="n">lt</span><span class="p">.</span> <span class="n">t2</span><span class="p">)</span><span class="k">then</span><span class="p">;</span> <span class="n">themin</span><span class="o">=&gt;</span><span class="n">t1</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="n">themin</span><span class="o">=&gt;</span><span class="n">t2</span><span class="p">;</span> <span class="k">endif</span>
<span class="k"> endif</span>
<span class="k">end function</span>
</code></pre></div>
<hr />
<hr />
<p>Exercise 4:  Carefully write a recursive N! program.</p>
<hr />
<hr />
<h2 id="function-and-subroutine-overloading">Function and subroutine overloading</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>Allows us to call functions or subroutine with the same name with different
    argument types</li>
<li>Increases readability</li>
</ul>
</li>
<li>
<p>Notes:</p>
<ul>
<li>Similar in concept to operator overloading</li>
<li>Requires an interface</li>
<li>Syntax for subroutines is same as for functions</li>
<li>Many intrinsic functions have this capability
        -  abs (reals,complex,integer)
            -  sin,cos,tan,exp(reals, complex)
            -  array functions(reals, complex,integer)</li>
<li>Example
        -  Recall we had two functions that did the same thing but with different argument types</li>
</ul>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>         recursive function realmin(ain) result (themin)
         real(b8) ,dimension(:) :: ain         recursive function typemin(ain) result (themin)
         type (thefit) ,dimension(:) :: ain
</code></pre></div>
- We can define a generic interface for these two functions and call
    them using the same name</p>
<div class="highlight"><pre><span></span><code><span class="c">! note we have two functions within the same interface</span>
<span class="c">! this is how we indicate function overloading</span>
<span class="c">! both functions are called &quot;findmin&quot; in the main program</span>
<span class="k">interface </span><span class="n">findmin</span>
<span class="c">! the first is called with an array of reals as input</span>
        <span class="k">recursive function </span><span class="n">realmin</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">themin</span><span class="p">)</span>
          <span class="k">use </span><span class="n">numz</span>
       <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">themin</span>
          <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="p">,</span><span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">ain</span>
        <span class="k">end function</span> <span class="c">! the second is called with a array of data structures as input</span>
     <span class="k">recursive function </span><span class="n">typemin</span><span class="p">(</span><span class="n">ain</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">themin</span><span class="p">)</span>
          <span class="k">use </span><span class="n">numz</span>
    <span class="k">use </span><span class="n">galapagos</span>
       <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">themin</span>
          <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">)</span> <span class="p">,</span><span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="n">ain</span>
     <span class="k">end function</span>
<span class="k">    end interface</span>
</code></pre></div>
<h3 id="example-usage">Example usage</h3>
<div class="highlight"><pre><span></span><code><span class="k">program </span><span class="n">darwin</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">use </span><span class="n">ran_mod</span>
    <span class="k">use </span><span class="n">galapagos</span> <span class="c">! the module that contains the type definition</span>
    <span class="k">use </span><span class="n">face</span>      <span class="c">! contains various interfaces</span>
    <span class="k">use </span><span class="n">sort_mod</span>  <span class="c">! more about this later it</span>
                  <span class="c">! contains our sorting routine</span>
      <span class="c">! and a few other tricks</span>
    <span class="k">implicit none</span>
<span class="c">! create an allocatable array of the data type</span>
<span class="c">! than contains an index and a real value</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">),</span><span class="k">allocatable</span> <span class="p">,</span><span class="k">target</span> <span class="kd">::</span> <span class="n">results</span><span class="p">(:)</span>
<span class="c">! create a single instance of the data type</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">)</span> <span class="n">best</span>
<span class="c">! pointers to our type</span>
    <span class="k">type</span> <span class="p">(</span><span class="n">thefit</span><span class="p">)</span> <span class="p">,</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">worst</span><span class="p">,</span><span class="n">tmp</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">genes</span><span class="p">(:,:)</span> <span class="c">! our genes for the ga</span>
    <span class="kt">integer </span><span class="n">j</span>
    <span class="kt">integer </span><span class="n">num_genes</span><span class="p">,</span><span class="n">gene_size</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">)</span> <span class="n">x</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">z</span><span class="p">(:)</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">xyz</span><span class="p">(:)</span> <span class="c">! we&#39;ll talk about this next</span>
    <span class="n">num_genes</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">gene_size</span><span class="o">=</span><span class="mi">10</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">results</span><span class="p">(</span><span class="n">num_genes</span><span class="p">))</span>         <span class="c">! allocate the data type to</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">genes</span><span class="p">(</span><span class="n">num_genes</span><span class="p">,</span><span class="n">gene_size</span><span class="p">))</span> <span class="c">! hold our collection of genes</span>
    <span class="k">call </span><span class="n">init_genes</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span>               <span class="c">! starting data</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(&quot;input&quot;)&#39;</span><span class="p">)</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_genes</span>
       <span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="nb">index</span><span class="o">=</span><span class="n">j</span>
       <span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">val</span><span class="o">=</span><span class="n">fitness</span><span class="p">(</span><span class="n">genes</span><span class="p">(</span><span class="n">j</span><span class="p">,:))</span> <span class="c">! just a dummy routine</span>
       <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;(f10.8,i4)&quot;</span><span class="p">)</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">val</span><span class="p">,</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="nb">index</span>
<span class="nb">    </span><span class="k">enddo     allocate</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">results</span><span class="p">)))</span>
    <span class="n">z</span><span class="o">=</span><span class="n">results</span><span class="p">(:)%</span><span class="n">val</span> <span class="c">! copy our results to a real array ! use a recursive subroutine operating on the real array</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;the lowest fitness: &quot;</span><span class="p">,</span><span class="n">findmin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="c">! use a recursive subroutine operating on the data structure</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;the lowest fitness: &quot;</span><span class="p">,</span><span class="n">findmin</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">end program</span>
</code></pre></div>
<hr />
<hr />
<h2 id="fortran-minval-and-minloc-routines">Fortran Minval and Minloc routines</h2>
<ul>
<li>Fortran has routines for finding minimum and maximum values in arrays and
    the locations<ul>
<li>minval</li>
<li>maxval</li>
<li>minloc (returns an array)</li>
<li>maxloc (returns an array)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">! we show two other methods of getting the minimum fitness</span>
<span class="c">! use the built in f90 routines  on a real array</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;the lowest fitness: &quot;</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="nb">minloc</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</code></pre></div>
<hr />
<hr />
<h2 id="pointer-assignment">Pointer assignment</h2>
<ul>
<li>This is how we use the pointer function defined above</li>
<li>worst is a pointer to our data type</li>
<li>note the use of =&gt;
<div class="highlight"><pre><span></span><code>! use a recursive subroutine operating on the data
! structure and returning a pointer to the result
    worst=&gt;pntmin(results) ! note pointer assignment
! what will this line write?
 write(*,*)&quot;the lowest fitness: &quot;,worst
</code></pre></div></li>
</ul>
<hr />
<hr />
<h2 id="more-pointer-usage-association-and-nullify">More pointer usage, association and nullify</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>Need to find if pointers point to anything</li>
<li>Need to find if two pointers point to the same thing</li>
<li>Need to deallocate and nullify when they are no longer used</li>
</ul>
</li>
<li>
<p>Usage</p>
<ul>
<li>We can use associated() to tell if a pointer has been set</li>
<li>We can use associated() to compare pointers</li>
<li>We use nullify to zero a pointer</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">! This code will print &quot;true&quot; when we find a match,</span>
<span class="c">! that is the pointers point to the same object</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_genes</span>
     <span class="n">tmp</span><span class="o">=&gt;</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;(f10.8,i4,l3)&quot;</span><span class="p">)</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">val</span><span class="p">,</span>   <span class="p">&amp;</span>
                                <span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="nb">index</span><span class="p">,</span> <span class="p">&amp;</span>
           <span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">worst</span><span class="p">)</span>
    <span class="k">enddo</span>
<span class="k">    nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>Notes:<ul>
<li>If a pointer is nullified the object to which it points is not deallocated.</li>
<li>In general, pointers as well as allocatable arrays become undefined on leaving a subroutine</li>
<li>This can cause a memory leak</li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="pointer-usage-to-reference-an-array-without-copying">Pointer usage to reference an array without copying</h2>
<ul>
<li>Motivation<ul>
<li>Our sort routine calls a recursive sorting routine</li>
<li>It is messy and inefficient to pass the array to the recursive routine</li>
</ul>
</li>
<li>Solution<ul>
<li>We define a "global" pointer in a module</li>
<li>We point the pointer to our input array</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">Merge_mod_types</span>
    <span class="k">use </span><span class="n">galapagos</span>
    <span class="k">type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">work</span><span class="p">(:)</span> <span class="c">! a &quot;global&quot; work array</span>
    <span class="k">type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span> <span class="k">pointer</span><span class="kd">::</span> <span class="n">a_pntr</span><span class="p">(:)</span>   <span class="c">! this will be the pointer to our input array</span>
<span class="k">end module </span><span class="n">Merge_mod_types</span>
  <span class="k">subroutine </span><span class="n">Sort</span><span class="p">(</span><span class="n">ain</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">use </span><span class="n">Merge_mod_types</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">integer </span><span class="n">n</span>
    <span class="k">type</span><span class="p">(</span><span class="n">thefit</span><span class="p">),</span> <span class="k">target</span><span class="kd">::</span> <span class="n">ain</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">nullify</span><span class="p">(</span><span class="n">a_pntr</span><span class="p">)</span>
    <span class="n">a_pntr</span><span class="o">=&gt;</span><span class="n">ain</span>  <span class="c">! we assign the pointer to our array</span>
                 <span class="c">! in RecMergeSort we reference it just like an array</span>
    <span class="k">call </span><span class="n">RecMergeSort</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="c">! very similar to the findmin functions</span>
    <span class="k">deallocate</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
    <span class="k">return</span>
<span class="k">end subroutine </span><span class="n">Sort</span>
</code></pre></div>
<ul>
<li>In our main program sort is called like this:
<div class="highlight"><pre><span></span><code><span class="c">! our sort routine is also recursive but</span>
<span class="c">! also shows a new usage for pointers</span>
    <span class="k">call </span><span class="n">sort</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="n">num_genes</span><span class="p">)</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_genes</span>
       <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s2">&quot;(f10.8,i4)&quot;</span><span class="p">)</span><span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">val</span><span class="p">,</span>   <span class="p">&amp;</span>
                            <span class="n">results</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="nb">index</span>
<span class="nb">    </span><span class="k">enddo</span>
</code></pre></div></li>
</ul>
<hr />
<hr />
<h2 id="data-assignment-with-structures">Data assignment with structures</h2>
<div class="highlight"><pre><span></span><code><span class="c">! we can copy a whole structure</span>
<span class="c">! with a single assignment</span>
    <span class="n">best</span><span class="o">=</span><span class="n">results</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;best result &quot;</span><span class="p">,</span><span class="n">best</span>
</code></pre></div>
<hr />
<hr />
<h2 id="using-the-user-defined-operator">Using the user defined operator</h2>
<div class="highlight"><pre><span></span><code><span class="c">! using the user defined operator to see if best is worst</span>
<span class="c">! recall that the operator .converged. checks to see if %index matches</span>
    <span class="n">worst</span><span class="o">=&gt;</span><span class="n">pntmin</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;worst result &quot;</span><span class="p">,</span><span class="n">worst</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;converged=&quot;</span><span class="p">,(</span><span class="n">best</span> <span class="p">.</span><span class="n">converged</span><span class="p">.</span> <span class="n">worst</span><span class="p">)</span>
</code></pre></div>
<hr />
<hr />
<h2 id="passing-arrays-with-a-given-arbitrary-lower-bounds">Passing arrays with a given arbitrary lower bounds</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>
<p>Default lower bound within a subroutine is 1</p>
</li>
<li>
<p>May want to use a different lower bound</p>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>    <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">:</span><span class="mi">10</span><span class="p">))</span> <span class="c">! a 21 element array</span>
    <span class="k">do </span><span class="n">j</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span>
       <span class="n">z</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">j</span>
    <span class="k">enddo</span> <span class="c">! pass z and its lower bound</span>
<span class="c">! in this routine we give the array a specific lower</span>
<span class="c">! bound and show how to use a pointer to reference</span>
<span class="c">! different parts of an array using different indices</span>
  <span class="k">call </span><span class="n">boink1</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">lbound</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="c">! why not just lbound(z) instead of lbound(z,1)?</span>
                             <span class="c">! lbound(z) returns a rank 1 array</span>
     <span class="k">subroutine </span><span class="n">boink1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
     <span class="k">use </span><span class="n">numz</span>
     <span class="k">implicit none</span>
<span class="k">     </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>
     <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">:)</span><span class="kd">::</span> <span class="n">a</span> <span class="c">! this is how we set lower bounds in a subroutine</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="nb">lbound</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nb">ubound</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
   <span class="k">end subroutine</span>
</code></pre></div>
<h3 id="warning-because-we-are-using-an-assumed-shape-array-we-need-an-interface">Warning:  because we are using an assumed shape array we need an interface</h3>
<h2 id="using-pointers-to-access-sections-of-arrays">Using pointers to access sections of arrays</h2>
<ul>
<li>Motivation<ul>
<li>Can increase efficiency</li>
<li>Can increase readability</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">call </span><span class="n">boink2</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">lbound</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="k">subroutine </span><span class="n">boink2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="k">use </span><span class="n">numz</span>
<span class="k">implicit none</span>
<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>
<span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">n</span><span class="p">:),</span><span class="k">target</span><span class="kd">::</span> <span class="n">a</span>
<span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">pointer</span><span class="kd">::</span><span class="n">b</span>
<span class="n">b</span><span class="o">=&gt;</span><span class="n">a</span><span class="p">(</span><span class="n">n</span><span class="p">:)</span> <span class="c">! b(1) &quot;points&quot; to a(-10)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;a(-10) =&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">),</span><span class="s2">&quot;b(1) =&quot;</span><span class="p">,</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span><span class="o">=&gt;</span><span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">:)</span> <span class="c">! b(1) &quot;points&quot; to a(0)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;a(-6) =&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">),</span><span class="s2">&quot;b(-5) =&quot;</span><span class="p">,</span><span class="n">b</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="k">end subroutine</span>
</code></pre></div>
<hr />
<hr />
<h2 id="allocating-an-array-inside-a-subroutine-and-passing-it-back">Allocating an array inside a subroutine and passing it back</h2>
<ul>
<li>Motivation<ul>
<li>Size of arrays are calculated in the subroutine</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">numz</span>
    <span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span><span class="kd">::</span> <span class="n">b8</span> <span class="o">=</span> <span class="nb">selected_real_kind</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="k">end module</span>
<span class="k">program </span><span class="n">bla</span>
   <span class="k">use </span><span class="n">numz</span>
   <span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="p">,</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">xyz</span>
   <span class="k">interface </span><span class="n">boink</span>
     <span class="k">subroutine </span><span class="n">boink</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
     <span class="k">use </span><span class="n">numz</span>
     <span class="k">implicit none</span>
<span class="k">     </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">a</span>
     <span class="k">end subroutine</span>
<span class="k">   end interface</span>
<span class="k">   nullify</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="c">! nullify sets a pointer to null</span>
   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(l5)&#39;</span><span class="p">)</span><span class="nb">associated</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="c">! is a pointer null, should be</span>
   <span class="k">call </span><span class="n">boink</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
   <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(l5)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span><span class="nb">associated</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
   <span class="k">if</span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">xyz</span><span class="p">))</span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(i5)&#39;</span><span class="p">)</span><span class="n">size</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
<span class="k">end program</span>
<span class="k">subroutine </span><span class="n">boink</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">use </span><span class="n">numz</span>
    <span class="k">implicit none</span>
<span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="n">b8</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">pointer</span><span class="kd">::</span> <span class="n">a</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">allocate</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="k">end subroutine</span>
</code></pre></div>
<h3 id="an-example-run_1">An example run</h3>
<div class="highlight"><pre><span></span><code>     F
     T
10
</code></pre></div>
<hr />
<hr />
<h2 id="our-fitness-function">Our fitness function</h2>
<p>Given a fixed number of colors, M, and a description of a map of a collection
of  N states.</p>
<p>Find a coloring of the map such that no two states that share a boarder
have the same coloring.</p>
<h3 id="example-input-is-a-sorted-list-of-22-western-states">Example input is a sorted list of 22 western states</h3>
<div class="highlight"><pre><span></span><code>22
ar ok tx la mo xx
az ca nm ut nv xx
ca az nv or xx
co nm ut wy ne ks xx
ia mo ne sd mn xx
id wa or nv ut wy mt xx
ks ne co ok mo xx
la tx ar xx
mn ia sd nd xx
mo ar ok ks ne ia xx
mt wy id nd xx
nd mt sd wy xx
ne sd wy co ks mo ia xx
nm az co ok tx mn xx
nv ca or id ut az xx
ok ks nm tx ar mo xx
or ca wa id xx
sd nd wy ne ia mn xx
tx ok nm la ar xx
ut nv az co wy id xx
wa id or mt xx
wy co mt id ut nd sd ne xx
</code></pre></div>
<p>Our fitness function takes a potential coloring, that is, an integer
vector of length N and a returns the number of boarders that have states
of the same coloring</p>
<ul>
<li>How do we represent the map in memory?<ul>
<li>One way would be to use an array but it would be very sparse</li>
<li>Linked lists are often a better way</li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="linked-lists">Linked lists</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>We have a collection of states and for each state a list of adjoining states. (Do not count a boarder twice.)</li>
<li>Problem is that you do not know the length of the list until runtime.</li>
<li>
<p>List of adjoining states will be different lengths for different states</p>
</li>
<li>
<p>Solution
        -   Linked list are a good way to handle such situations</p>
</li>
<li>Linked lists use a derived data type with at least two components<ul>
<li>Data  </li>
<li>Pointer to next element</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">module </span><span class="n">list_stuff</span>
<span class="k">type </span><span class="n">llist</span>
<span class="kt">integer </span><span class="nb">index</span> <span class="c">! data</span>
<span class="k">type</span><span class="p">(</span><span class="n">llist</span><span class="p">),</span><span class="k">pointer</span><span class="kd">::</span><span class="n">next</span> <span class="c">! pointer to the</span>
<span class="c">! next element</span>
<span class="k">end type </span><span class="n">llist</span>
<span class="k">end module</span>
</code></pre></div>
<hr />
<hr />
<h2 id="linked-list-usage">Linked list usage</h2>
<p>One way to fill a linked list is to use a recursive function
<code>`fortran</code>
recursive subroutine insert (item, root)
use list_stuff
implicit none
type(llist), pointer :: root
integer item
if (.not. associated(root)) then
allocate(root)
nullify(root%next)
root%index = item
else
call insert(item,root%next)
endif
end subroutine
<div class="highlight"><pre><span></span><code>- - -
- - -

## Our map representation
- An array of the derived data type states
            -   State is name of a state
    -   Linked list containing boarders

```fortran
    type states
        character(len=2)name
        type(llist),pointer:: list
    end type states
</code></pre></div>
- Notes:
    -  We have an array of linked lists
            -  This data structure is often used to represent sparse arrays
                -  We could have a linked list of linked lists
    -  State name is not really required</p>
<hr />
<hr />
<h2 id="date-and-time-functions">Date and time functions</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>
<p>May want to know the date and time of your program</p>
</li>
<li>
<p>Two functions</p>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">! all arguments are optional</span>
<span class="k">call </span><span class="nb">date_and_time</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">c_date</span><span class="p">,</span> <span class="p">&amp;</span>  <span class="c">! character(len=8) ccyymmdd</span>
                   <span class="nb">time</span><span class="o">=</span><span class="n">c_time</span><span class="p">,</span> <span class="p">&amp;</span>  <span class="c">! character(len=10) hhmmss.sss</span>
                   <span class="n">zone</span><span class="o">=</span><span class="n">c_zone</span><span class="p">,</span> <span class="p">&amp;</span>  <span class="c">! character(len=10) +/-hhmm (time zone)</span>
                   <span class="n">values</span><span class="o">=</span><span class="n">ivalues</span><span class="p">)</span> <span class="c">! integer ivalues(8) all of the above</span>
           <span class="k">call </span><span class="nb">system_clock</span><span class="p">(</span><span class="nb">count</span><span class="o">=</span><span class="n">ic</span><span class="p">,</span>           <span class="p">&amp;</span> <span class="c">! count of system clock (clicks)</span>
                  <span class="n">count_rate</span><span class="o">=</span><span class="n">icr</span><span class="p">,</span>     <span class="p">&amp;</span> <span class="c">! clicks / second</span>
                  <span class="n">count_max</span><span class="o">=</span><span class="n">max_c</span><span class="p">)</span>      <span class="c">! max value for count</span>
</code></pre></div>
<hr />
<hr />
<h2 id="non-advancing-and-character-io">Non advancing and character IO</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>
<p>We read the states using the two character identification</p>
</li>
<li>
<p>One line per state and do not know how many boarder states per line</p>
</li>
</ul>
</li>
<li>
<p>Note: Our list of states is presorted
<div class="highlight"><pre><span></span><code><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="n">a</span> <span class="c">! we have a character variable of length 2</span>
<span class="k">read</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">nstates</span> <span class="c">! read the number of states</span>
<span class="k">allocate</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">nstates</span><span class="p">))</span> <span class="c">! and allocate our map</span>
<span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nstates</span>
    <span class="k">read</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s2">&quot;(a2)&quot;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span><span class="n">map</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">name</span> <span class="c">! read the name</span>
    <span class="c">!write(*,*)&quot;state:&quot;,map(i)%name</span>
    <span class="k">nullify</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">list</span><span class="p">)</span> <span class="c">! &quot;zero out&quot; our list</span>
    <span class="k">do</span>
<span class="k">        read</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s2">&quot;(1x,a2)&quot;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">)</span><span class="n">a</span> <span class="c">! read list of states</span>
        <span class="c">! without going to the</span>
        <span class="c">! next line</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">lge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s2">&quot;xx&quot;</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">lle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="s2">&quot;xx&quot;</span><span class="p">))</span><span class="k">then</span> <span class="c">! if state == xx</span>
        <span class="k">backspace</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="c">! go to the next line</span>
        <span class="k">read</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="s2">&quot;(1x,a2)&quot;</span><span class="p">,</span><span class="k">end</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="n">a</span> <span class="c">! go to the next line</span>
        <span class="k">exit</span>
<span class="k">        endif</span>
<span class="k">        </span><span class="mi">1</span> <span class="k">continue</span>
<span class="k">        if</span><span class="p">(</span><span class="nb">llt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">map</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">name</span><span class="p">))</span><span class="k">then</span> <span class="c">! we only add a state to</span>
        <span class="c">! our list if its name</span>
        <span class="c">! is before ours thus we</span>
        <span class="c">! only count boarders 1 time</span>
        <span class="c">! what we want put into our linked list is an index</span>
        <span class="c">! into our map where we find the bordering state</span>
        <span class="c">! thus we do the search here</span>
        <span class="c">! any ideas on a better way of doing this search?</span>
        <span class="n">found</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">lge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">map</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">name</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">lle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">map</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">name</span><span class="p">))</span><span class="k">then</span>
            <span class="c">!write(*,*)a</span>
            <span class="n">found</span><span class="o">=</span><span class="n">j</span>
            <span class="k">exit</span>
<span class="k">            endif</span>
<span class="k">        enddo</span>
<span class="k">        if</span><span class="p">(</span><span class="n">found</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<span class="k">            write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;error&quot;</span>
            <span class="k">stop</span>
<span class="k">        endif</span>
        <span class="c">! found the index of the boarding state insert it into our list</span>
        <span class="c">! note we do the insert into the linked list for a particular state</span>
        <span class="k">call </span><span class="n">insert</span><span class="p">(</span><span class="n">found</span><span class="p">,</span><span class="n">map</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">list</span><span class="p">)</span>
        <span class="k">endif</span>
<span class="k">    enddo</span>
<span class="k">enddo</span>
</code></pre></div></p>
</li>
</ul>
<hr />
<hr />
<h2 id="internal-io">Internal IO</h2>
<ul>
<li>
<p>Motivation</p>
<ul>
<li>
<p>May need to create strings on the fly</p>
</li>
<li>
<p>May need to convert from strings to reals and integers</p>
</li>
<li>
<p>Similar to sprintf and sscanf</p>
</li>
</ul>
</li>
<li>
<p>How it works</p>
<ul>
<li>
<p>Create a string</p>
</li>
<li>
<p>Do a normal write except write to the string instead of file number</p>
</li>
</ul>
</li>
<li>
<p>Example 1: creating a date and time stamped file name</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kt">character</span> <span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="n">tmpstr</span>

<span class="k">write</span><span class="p">(</span><span class="n">tmpstr</span><span class="p">,</span><span class="s2">&quot;(a12)&quot;</span><span class="p">)(</span><span class="n">c_date</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">)</span><span class="o">//</span><span class="n">c_time</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;.dat&quot;</span><span class="p">)</span> <span class="c">! // does string concatination</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;name of file= &quot;</span><span class="p">,</span><span class="n">tmpstr</span>
<span class="k">open</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="n">tmpstr</span><span class="p">)</span>
<span class="n">name</span> <span class="n">of</span> <span class="k">file</span><span class="o">=</span> <span class="mi">0327111</span><span class="mf">4.</span><span class="n">dat</span>
</code></pre></div>
<ul>
<li>Example 2: Creating a format statement at run time (array of integers and a real)</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="c">! test_vect is an array that we do not know its length until run time</span>
<span class="n">nstate</span><span class="o">=</span><span class="mi">9</span> <span class="c">! the size of the array</span>
<span class="k">write</span><span class="p">(</span><span class="n">fstr</span><span class="p">,</span><span class="s1">&#39;(&quot;(&quot;,i4,&quot;i1,1x,f10.5)&quot;)&#39;</span><span class="p">)</span><span class="n">nstates</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;format= &quot;</span><span class="p">,</span><span class="n">fstr</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">fstr</span><span class="p">)</span><span class="n">test_vect</span><span class="p">,</span><span class="n">fstr</span>
<span class="k">format</span><span class="o">=</span> <span class="p">(</span> <span class="mi">9</span><span class="n">i1</span><span class="p">,</span><span class="mi">1</span><span class="n">x</span><span class="p">,</span><span class="n">f10</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
Any other ideas for writing an array when you do not know its length?</p>
<ul>
<li>Example 3: Reading from a string
<div class="highlight"><pre><span></span><code><span class="kt">integer </span><span class="n">ht</span><span class="p">,</span><span class="n">minut</span><span class="p">,</span><span class="n">sec</span>
<span class="k">read</span><span class="p">(</span><span class="n">c_time</span><span class="p">,</span><span class="s2">&quot;(3i2)&quot;</span><span class="p">)</span><span class="n">hr</span><span class="p">,</span><span class="n">minut</span><span class="p">,</span><span class="n">sec</span>
</code></pre></div></li>
</ul>
<hr />
<hr />
<h2 id="inquire-function">Inquire function</h2>
<ul>
<li>Motivation<ul>
<li>Need to get information about I/O</li>
</ul>
</li>
<li>
<p>Inquire statement has two forms</p>
<ul>
<li>Information about files (23 different requests can be done)</li>
<li>Information about space required for binary output of a value</li>
</ul>
</li>
<li>
<p>Example: find the size of your real relative to the "standard" real</p>
<ul>
<li>Useful for inter language programming</li>
<li>Useful for determining data types in MPI (MPI_REAL or MPI_DOUBLE_PRECISION)</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">inquire</span><span class="p">(</span><span class="n">iolength</span><span class="o">=</span><span class="n">len_real</span><span class="p">)</span><span class="mf">1.0</span>
<span class="k">inquire</span><span class="p">(</span><span class="n">iolength</span><span class="o">=</span><span class="n">len_b8</span><span class="p">)</span><span class="mf">1.0_b8</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;len_b8 &quot;</span><span class="p">,</span><span class="n">len_b8</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;len_real&quot;</span><span class="p">,</span><span class="n">len_real</span>
<span class="n">iratio</span><span class="o">=</span><span class="n">len_b8</span><span class="o">/</span><span class="n">len_real</span>
<span class="k">select case</span> <span class="p">(</span><span class="n">iratio</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">my_mpi_type</span><span class="o">=</span><span class="n">mpi_real</span>
    <span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">my_mpi_type</span><span class="o">=</span><span class="n">mpi_double_precision</span>
    <span class="k">case </span><span class="n">default</span>
      <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s2">&quot;type undefined&quot;</span>
      <span class="n">my_mpi_type</span><span class="o">=</span><span class="mi">0</span>
<span class="k">end select</span>
</code></pre></div>
<h3 id="an-example-run_2">An example run</h3>
<div class="highlight"><pre><span></span><code><span class="n">len_b8</span> <span class="mi">2</span>
<span class="n">len_real</span> <span class="mi">1</span>
</code></pre></div>
<hr />
<hr />
<h2 id="namelist">Namelist</h2>
<ul>
<li>Now part of the standard</li>
<li>Motivation<ul>
<li>A convenient method of doing I/O</li>
<li>Good for cases where you have similar runs but change one or two variables</li>
<li>Good for formatted output</li>
</ul>
</li>
<li>
<p>Notes:</p>
<ul>
<li>A little flaky</li>
<li>No options for overloading format</li>
</ul>
</li>
<li>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="kt">integer </span><span class="n">ncolor</span>
<span class="kt">logical </span><span class="n">force</span>
<span class="k">namelist</span> <span class="o">/</span><span class="n">the_input</span><span class="o">/</span><span class="n">ncolor</span><span class="p">,</span><span class="n">force</span>
<span class="n">ncolor</span><span class="o">=</span><span class="mi">4</span>
<span class="n">force</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="k">read</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">the_input</span><span class="p">)</span>
<span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">the_input</span><span class="p">)</span>
</code></pre></div>
On input:
<div class="highlight"><pre><span></span><code>&amp; THE_INPUT NCOLOR=4,FORCE = F /
</code></pre></div>
Output is
<div class="highlight"><pre><span></span><code>&amp;THE_INPUT
NCOLOR = 4,
FORCE = F
/
</code></pre></div></p>
</li>
</ul>
<hr />
<hr />
<h2 id="vector-valued-functions">Vector valued functions</h2>
<ul>
<li>Motivation<ul>
<li>May want a function that returns a vector</li>
</ul>
</li>
<li>
<p>Notes</p>
<ul>
<li>Again requires an interface</li>
<li>Use explicit or assumed size array</li>
<li>Do not return a pointer to a vector unless you really want a pointer</li>
</ul>
</li>
<li>
<p>Example:</p>
<ul>
<li>Take an integer input vector which represents an integer in some base and
    add 1</li>
<li>Could be used in our program to find a "brute force" solution</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>  <span class="k">function </span><span class="n">add1</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="nb">max</span><span class="p">)</span> <span class="k">result</span> <span class="p">(</span><span class="n">rtn</span><span class="p">)</span>
  <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span>  <span class="n">vector</span>
  <span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">vector</span><span class="p">))</span> <span class="kd">::</span> <span class="n">rtn</span>
  <span class="kt">integer </span><span class="nb">max</span>
<span class="nb">  </span><span class="kt">integer </span><span class="nb">len</span>
<span class="nb">  </span><span class="kt">logical </span><span class="n">carry</span>
  <span class="nb">len</span><span class="o">=</span><span class="n">size</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
  <span class="n">rtn</span><span class="o">=</span><span class="n">vector</span>
  <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
  <span class="n">carry</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
  <span class="k">do while</span><span class="p">(</span><span class="n">carry</span><span class="p">)</span>         <span class="c">! just continue until we do not do a carry</span>
      <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
   <span class="n">rtn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="n">rtn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
   <span class="k">if</span><span class="p">(</span><span class="n">rtn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">.</span><span class="n">gt</span><span class="p">.</span> <span class="nb">max</span><span class="p">)</span><span class="k">then</span>
<span class="k">       if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">)</span><span class="k">then</span>   <span class="c">! role over set everything back to 0</span>
        <span class="n">rtn</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">rtn</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span>
       <span class="k">endif</span>
<span class="k">   else</span>
<span class="k">       </span><span class="n">carry</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
   <span class="k">endif</span>
<span class="k">  enddo</span>
<span class="k">end function</span>
</code></pre></div>
<h3 id="usage">Usage</h3>
<div class="highlight"><pre><span></span><code><span class="n">test_vect</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">do</span>
<span class="k">           </span><span class="n">test_vect</span><span class="o">=</span><span class="n">add1</span><span class="p">(</span><span class="n">test_vect</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
           <span class="k">result</span><span class="o">=</span><span class="n">fitness</span><span class="p">(</span><span class="n">test_vect</span><span class="p">)</span>
           <span class="k">if</span><span class="p">(</span><span class="k">result</span> <span class="p">.</span><span class="n">lt</span><span class="p">.</span> <span class="mf">1.0_b8</span><span class="p">)</span><span class="k">then</span>
<span class="k">               write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="n">test_vect</span>
               <span class="k">stop</span>
<span class="k">           endif</span>
<span class="k">        enddo</span>
</code></pre></div>
<hr />
<hr />
<h2 id="complete-source-for-recent-discussions">Complete source for recent discussions</h2>
<ul>
<li><a href="source/recent.f90">recent.f90</a></li>
<li><a href="source/fort.13">fort.13</a></li>
</ul>
<hr />
<hr />
<p>Exersize 5  Modify the program to use the random
number generator given earlier.</p>
<hr />
<hr />
<h2 id="some-array-specific-intrinsic-functions">Some array specific intrinsic functions</h2>
<ul>
<li>ALL True if all values are true (LOGICAL)</li>
<li>ANY True if any value is true (LOGICAL)</li>
<li>COUNT Number of true elements in an array (LOGICAL)</li>
<li>DOT_PRODUCT Dot product of two rank one arrays</li>
<li>MATMUL Matrix multiplication</li>
<li>MAXLOC Location of a maximum value in an array</li>
<li>MAXVAL Maximum value in an array</li>
<li>MINLOC Location of a minimum value in an array</li>
<li>MINVAL Minimum value in an array</li>
<li>PACK Pack an array into an array of rank one</li>
<li>PRODUCT Product of array elements</li>
<li>RESHAPE  Reshape an array</li>
<li>SPREAD Replicates array by adding a dimension</li>
<li>SUM Sum of array elements</li>
<li>TRANSPOSE Transpose an array of rank two</li>
<li>
<p>UNPACK Unpack an array of rank one into an array under a mask</p>
</li>
<li>
<p>Examples</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">program </span><span class="n">matrix</span>
    <span class="kt">real </span><span class="n">w</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">x</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">mat</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
    <span class="k">call </span><span class="nb">random_number</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
    <span class="n">x</span><span class="o">=</span><span class="nb">matmul</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">mat</span><span class="p">)</span>   <span class="c">! regular matrix multiply  USE IT</span>
    <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="s1">&#39;(&quot;dot(x,x)=&quot;,f10.5)&#39;</span><span class="p">),</span><span class="nb">dot_product</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="k">end program</span>
<span class="k">program </span><span class="n">allit</span>
     <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="kd">::</span> <span class="n">f1</span><span class="o">=</span><span class="s2">&quot;(3l1)&quot;</span>
     <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="kd">::</span> <span class="n">f2</span><span class="o">=</span><span class="s2">&quot;(3i2)&quot;</span>
     <span class="kt">integer </span><span class="n">b</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">one_d</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
     <span class="kt">logical </span><span class="n">l</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
     <span class="n">one_d</span><span class="o">=</span><span class="p">(</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span> <span class="o">/</span><span class="p">)</span>
     <span class="n">b</span><span class="o">=</span><span class="nb">transpose</span><span class="p">(</span><span class="nb">reshape</span><span class="p">((</span><span class="o">/</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span> <span class="o">/</span><span class="p">),</span><span class="nb">shape</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="p">)))</span>
     <span class="n">C</span><span class="o">=</span><span class="nb">transpose</span><span class="p">(</span><span class="nb">reshape</span><span class="p">((</span><span class="o">/</span> <span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span> <span class="p">,</span> <span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span> <span class="o">/</span><span class="p">),</span><span class="nb">shape</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="o">/</span><span class="p">)))</span>
     <span class="n">l</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">f2</span><span class="p">)((</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">f2</span><span class="p">)((</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">f1</span><span class="p">)((</span><span class="n">l</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="k">all</span> <span class="p">(</span> <span class="n">b</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="n">C</span> <span class="p">)</span> <span class="c">!is .false.</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="k">all</span> <span class="p">(</span> <span class="n">b</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="n">C</span><span class="p">,</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c">!is [.true., .false., .false.]</span>
     <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="n">f1</span><span class="p">)</span><span class="k">all</span> <span class="p">(</span> <span class="n">b</span> <span class="p">.</span><span class="n">ne</span><span class="p">.</span> <span class="n">C</span><span class="p">,</span> <span class="nb">DIM</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c">!is [.false., .false.]</span>
<span class="k">end</span>
</code></pre></div>
<ul>
<li>The output is:</li>
</ul>
<div class="highlight"><pre><span></span><code> 1 3 5
 2 4 6
 0 3 5
 7 4 8
 TFF
 TFT
 F
 TFF
 FF
</code></pre></div>
<hr />
<hr />
<h2 id="the-rest-of-our-ga">The rest of our GA</h2>
<ul>
<li>Includes</li>
<li>Reproduction</li>
<li>Mutation</li>
<li>Nothing new in either of these files</li>
<li><a href="source">Source and makefile "git"</a></li>
<li><a href="https://github.com/timkphd/examples/raw/master/fort/90/source/archive.tgz">Source and makefile "*tgz"</a></li>
</ul>
<hr />
<hr />
<h2 id="compiler-information">Compiler Information</h2>
<h3 id="gfortran">gfortran</h3>
<ul>
<li>.f, .for, .ftn .f77<ul>
<li>fixed-format Fortran source; compile</li>
</ul>
</li>
<li>.f90, .f95<ul>
<li>free-format Fortran source; compile</li>
</ul>
</li>
<li>-fbacktrace<ul>
<li>Add debug information for runtime traceback</li>
</ul>
</li>
<li>-ffree-form -ffixed-form<ul>
<li>source form</li>
</ul>
</li>
<li>-O0, -O1, -O2, -O3<ul>
<li>optimization level</li>
</ul>
</li>
<li>.fpp, .FPP,  .F, .FOR, .FTN, .F90, .F95, .F03 or .F08<ul>
<li>Fortran source file with preprocessor directives</li>
</ul>
</li>
<li>-fopenmp<ul>
<li>turn on OpenMP</li>
</ul>
</li>
</ul>
<h3 id="intel">Intel</h3>
<ul>
<li>.f, .for, .ftn<ul>
<li>fixed-format Fortran source; compile</li>
</ul>
</li>
<li>.f90, .f95<ul>
<li>free-format Fortran source; compile</li>
</ul>
</li>
<li>-O0, -O1, -O2, -O3, -O4<ul>
<li>optimization level</li>
</ul>
</li>
<li>.fpp, .F, .FOR, .FTN, .FPP, .F90<ul>
<li>Fortran source file with preprocessor directives</li>
</ul>
</li>
<li>-g<ul>
<li>compile for debug     * -traceback -notraceback (default)</li>
<li>Add debug information for runtime traceback</li>
</ul>
</li>
<li>-nofree, -free<ul>
<li>Source is fixed or free format</li>
</ul>
</li>
<li>-fopenmp<ul>
<li>turn on OpenMP</li>
</ul>
</li>
</ul>
<h3 id="portland-group-x86">Portland Group (x86)</h3>
<ul>
<li>.f, .for, .ftn<ul>
<li>fixed-format Fortran source; compile</li>
</ul>
</li>
<li>.f90, .f95, .f03<ul>
<li>free-format Fortran source; compile</li>
</ul>
</li>
<li>.cuf<ul>
<li>free-format CUDA Fortran source; compile</li>
</ul>
</li>
<li>
<p>.CUF</p>
<ul>
<li>free-format CUDA Fortran source; preprocess, compile</li>
</ul>
</li>
<li>
<p>-O0, -O1, -O2, -O3, -O4</p>
<ul>
<li>optimization level</li>
</ul>
</li>
<li>
<p>-g</p>
<ul>
<li>compile for debug       *    -traceback (default) -notraceback</li>
<li>Add debug information for runtime traceback</li>
</ul>
</li>
<li>-Mfixed, -Mfree<ul>
<li>Source is fixed or free format</li>
</ul>
</li>
<li>-qmp<ul>
<li>turn on OpenMP</li>
</ul>
</li>
</ul>
<h3 id="ibm-xlf">IBM xlf</h3>
<ul>
<li>xlf, xlf_r, f77, fort77<ul>
<li>Compile FORTRAN 77 source files.  _r = thread safe</li>
</ul>
</li>
<li>xlf90, xlf90_r, f90<ul>
<li>Compile Fortran 90 source files.  _r = thread safe</li>
</ul>
</li>
<li>xlf95, xlf95_r, f95<ul>
<li>Compile Fortran 95 source files.  _r = thread safe</li>
</ul>
</li>
<li>xlf2003, xlf2003_r,f2003  * Compile Fortran 2003 source files. _r = thread safe</li>
<li>xlf2008, xlf2008_r, f2008     * Compile Fortran 2008 source files.</li>
<li>.f, .f77, .f90, .f95, .f03, .f08<ul>
<li>Fortran source file</li>
</ul>
</li>
<li>.F, .F77, .F90, .F95,  .F03, .F08<ul>
<li>Fortran source file with preprocessor directives</li>
</ul>
</li>
<li>-qtbtable=full<ul>
<li>Add debug information for runtime traceback</li>
</ul>
</li>
<li>-qsmp=omp<ul>
<li>turn on OpenMP</li>
</ul>
</li>
<li>-O0, -O1, -O2, -O3, -O4, O5<ul>
<li>optimization level</li>
</ul>
</li>
<li>-g , g0, g1,...g9<ul>
<li>compile for debug     </li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="summary_1">Summary</h2>
<ul>
<li>
<p>Fortran 90 has features to:</p>
<ul>
<li>Enhance performance</li>
<li>Enhance portability</li>
<li>Enhance reliability</li>
<li>Enhance maintainability</li>
</ul>
</li>
<li>
<p>Fortran 90 has new language elements</p>
<ul>
<li>Source form</li>
<li>Derived data types</li>
<li>Dynamic memory allocation functions</li>
<li>Kind facility for portability and easy modification</li>
<li>Many new intrinsic function</li>
<li>Array assignments</li>
</ul>
</li>
<li>
<p>Examples</p>
<ul>
<li>Help show how things work</li>
<li>Reference for future use</li>
</ul>
</li>
</ul>
<hr />
<hr />
<h1 id="overview-of-f90">Overview of F90</h1>
<ol>
<li><a href="#introduction-to-fortran-language">Introduction to Fortran Language</a></li>
<li><a href="#meta-language-used-in-this-compact-summary">Meta language used in this compact summary</a></li>
<li><a href="#structure-of-files-that-can-be-compiled">Structure of files that can be compiled</a></li>
<li><a href="#executable-statements-and-constructs">Executable Statements and Constructs</a></li>
<li><a href="#declarations">Declarations</a></li>
<li><a href="#key-words-/-other-than-I/O">Key words - other than I/O</a></li>
<li><a href="#key-words-related-to-I/O">Key words related to I/O</a></li>
<li><a href="#operators">Operators</a></li>
<li><a href="#constants">Constants</a></li>
<li><a href="#input/output-statements">Input/Output Statements</a></li>
<li><a href="#formats">Formats</a></li>
<li><a href="#intrinsic-functions">Intrinsic Functions</a></li>
</ol>
<h2 id="introduction-to-fortran-language">Introduction to Fortran Language</h2>
<div class="highlight"><pre><span></span><code>  Brought to you by ANSI committee X3J3 and ISO-IEC/JTC1/SC22/WG5 (Fortran)
  This is neither complete nor precisely accurate, but hopefully, after
  a small investment of time it is easy to read and very useful.

  This is the free form version of Fortran, no statement numbers,
  no C in column 1, start in column 1 (not column 7),
  typically indent 2, 3, or 4 spaces per each structure.
  The typical extension is  .f90  .

  Continue a statement on the next line by ending the previous line with
  an ampersand  &amp;amp; .  Start the continuation with  &amp;amp;  for strings.

  The rest of any line is a comment starting with an exclamation mark  ! .

  Put more than one statement per line by separating statements with a
  semicolon  ; . Null statements are OK, so lines can end with semicolons.

  Separate words with space or any form of &quot;white space&quot; or punctuation.
</code></pre></div>
<h2 id="meta-language-used-in-this-compact-summary">Meta language used in this compact summary</h2>
<div class="highlight"><pre><span></span><code>  &lt;xxx&gt; means fill in something appropriate for xxx and do not type
        the  &quot;&lt;&quot;  or  &quot;&gt;&quot; .

  ...  ellipsis means the usual, fill in something, one or more lines

  [stuff] means supply nothing or at most one copy of &quot;stuff&quot;
          [stuff1 [stuff2]] means if &quot;stuff1&quot; is included, supply nothing
          or at most one copy of stuff2.

  &quot;old&quot; means it is in the language, like almost every feature of past
  Fortran standards, but should not be used to write new programs.
</code></pre></div>
<h2 id="structure-of-files-that-can-be-compiled">Structure of files that can be compiled</h2>
<div class="highlight"><pre><span></span><code>  program &lt;name&gt;                  usually file name is  &lt;name&gt;.f90
    use &lt;module_name&gt;             bring in any needed modules
    implicit none                 good for error detection
    &lt;declarations&gt;
    &lt;executable statements&gt;       order is important, no more declarations
  end program &lt;name&gt;


  block data &lt;name&gt;               old
    &lt;declarations&gt;                common, dimension, equivalence now obsolete
  end block data &lt;name&gt;


  module &lt;name&gt;                   bring back in with   use &lt;name&gt;
    implicit none                 good for error detection
    &lt;declarations&gt;                can have private and public and interface
  end module &lt;name&gt;

  subroutine &lt;name&gt;               use:  call &lt;name&gt;   to execute
    implicit none                 good for error detection
    &lt;declarations&gt;
    &lt;executable statements&gt;
  end subroutine &lt;name&gt;


  subroutine &lt;name&gt;(par1, par2, ...) 
                                  use:  call &lt;name&gt;(arg1, arg2,... ) to execute
    implicit none                 optional, good for error detection
    &lt;declarations&gt;                par1, par2, ... are defined in declarations 
                                  and can be specified in, inout, pointer, etc.
    &lt;executable statements&gt;
    return                        optional, end causes automatic return
    entry &lt;name&gt; (par...)         old, optional other entries
  end subroutine &lt;name&gt;


  function &lt;name&gt;(par1, par2, ...) result(&lt;rslt&gt;)
                                  use: &lt;name&gt;(arg1, arg2, ... argn) as variable
    implicit none                 optional, good for error detection
    &lt;declarations&gt;                rslt, par1, ... are defined in declarations
    &lt;executable statements&gt;
    &lt;rslt&gt; = &lt;expression&gt;         required somewhere in execution
    [return]                      optional, end causes automatic return
  end function &lt;name&gt;

                                  old
  &lt;type&gt; function(...) &lt;name&gt;     use: &lt;name&gt;(arg1, arg2, ... argn) as variable
    &lt;declarations&gt;
    &lt;executable statements&gt;
    &lt;name&gt; = &lt;expression&gt;         required somewhere in execution
    [return]                      optional, end causes automatic return
  end function &lt;name&gt;
</code></pre></div>
<h2 id="executable-statements-and-constructs">Executable Statements and Constructs</h2>
<div class="highlight"><pre><span></span><code>  &lt;statement&gt; will mean exactly one statement in this section

  a construct is multiple lines

  &lt;label&gt; : &lt;statement&gt;      any statement can have a label (a name)

  &lt;variable&gt; = &lt;expression&gt;  assignment statement

  &lt;pointer&gt;  &gt;= &lt;variable&gt;   the pointer is now an alias for the variable
  &lt;pointer1&gt; &gt;= &lt;pointer2&gt;    pointer1 now points same place as pointer2

  stop                       can be in any executable statement group,
  stop &lt;integer&gt;             terminates execution of the program,
  stop &lt;string&gt;              can have optional integer or string

  return                     exit from subroutine or function

  do &lt;variable&gt;=&lt;from&gt;,&lt;to&gt; [,&lt;increment&amp;gt]   optional:  &lt;label&gt; : do ...
     &lt;statements&gt;

     exit                                   \_optional   or exit &lt;label&amp;gt
     if (&lt;boolean expression&gt;) exit         /
                                            exit the loop
     cycle                                  \_optional   or cycle &lt;label&gt;
     if (&lt;boolean expression&gt;) cycle        /
                                            continue with next loop iteration
  end do                                    optional:    end do &lt;name&gt;


  do while (&lt;boolean expression&gt;)
     ...                                   optional exit and cycle allowed
  end do


  do
     ...                                   exit required to end the loop
                                           optional  cycle  can be used
  end do



  if ( &lt;boolean expression&gt; ) &lt;statement&gt;  execute the statement if the
                                           boolean expression is true

  if ( &lt;boolean expression1&gt; ) then
    ...                                    execute if expression1 is true
  else if ( &lt;boolean expression2&gt; ) then
    ...                                    execute if expression2 is true
  else if ( &lt;boolean expression3&gt; ) then
    ...                                    execute if expression3 is true
  else
    ...                                    execute if none above are true
  end if


  select case (&lt;expression&gt;)            optional &lt;name&gt; : select case ...
     case (&lt;value&gt;)
        &lt;statements&gt;                    execute if expression == value
     case (&lt;value1&gt;:&lt;value2&gt;)           
        &lt;statements&gt;                    execute if value1 &amp;le; expression &amp;le; value2
     ...
     case default
        &lt;statements&gt;                    execute if no values above match
  end select                            optional  end select &lt;name&gt;


  real, dimension(10,12) :: A, R     a sample declaration for use with &quot;where&quot;
    ...
  where (A /= 0.0)                   conditional assignment, only assignment allowed
     R = 1.0/A
  elsewhere
     R = 1.0                         elements of R set to 1.0 where A == 0.0
  end where

    go to &lt;statement number&gt;          old

    go to (&lt;statement number list&gt;), &lt;expression&gt;   old

    for I/O statements, see:  section 10.0  Input/Output Statements

    many old forms of statements are not listed
</code></pre></div>
<h2 id="declarations">Declarations</h2>
<div class="highlight"><pre><span></span><code>  There are five (5) basic types: integer, real, complex, character and logical.
  There may be any number of user derived types.  A modern (not old) declaration
  starts with a type, has attributes, then ::, then variable(s) names

  integer i, pivot, query                             old

  integer, intent (inout) :: arg1

  integer (selected_int_kind (5)) :: i1, i2

  integer, parameter :: m = 7

  integer, dimension(0:4, -5:5, 10:100) :: A3D

  double precision x                                 old

  real  (selected_real_kind(15,300) :: x

  complex :: z

  logical, parameter :: what_if = .true.

  character, parameter :: me = &quot;Jon Squire&quot;

  type &lt;name&gt;       a new user type, derived type
    declarations
  end type &lt;name&gt;

  type (&lt;name&gt;) :: stuff    declaring stuff to be of derived type &lt;name&gt;

  real, dimension(:,:), allocatable, target :: A

  real, dimension(:,:), pointer :: P

  Attributes may be:

    allocatable  no memory used here, allocate later
    dimension    vector or multi dimensional array
    external     will be defined outside this compilation
    intent       argument may be  in, inout or out
    intrinsic    declaring function to be an intrinsic
    optional     argument is optional
    parameter    declaring a constant, can not be changed later
    pointer      declaring a pointer
    private      in a module, a private declaration
    public       in a module, a public declaration
    save         keep value from one call to the next, static
    target       can be pointed to by a pointer
    Note:        not all combinations of attributes are legal
</code></pre></div>
<h2 id="key-words-other-than-io">Key words (other than I/O)</h2>
<div class="highlight"><pre><span></span><code>  note: &quot;statement&quot; means key word that starts a statement, one line
                    unless there is a continuation &quot;&amp;amp;&quot;
        &quot;construct&quot; means multiple lines, usually ending with &quot;end ...&quot;
        &quot;attribute&quot; means it is used in a statement to further define
        &quot;old&quot;       means it should not be used in new code

  allocatable          attribute, no space allocated here, later allocate
  allocate             statement, allocate memory space now for variable
  assign               statement, old, assigned go to
  assignment           attribute, means subroutine is assignment (=)
  block data           construct, old, compilation unit, replaced by module
  call                 statement, call a subroutine
  case                 statement, used in  select case structure
  character            statement, basic type, intrinsic data type
  common               statement, old, allowed overlaying of storage
  complex              statement, basic type, intrinsic data type
  contains             statement, internal subroutines and functions follow
  continue             statement, old, a place to put a statement number
  cycle                statement, continue the next iteration of a do loop
  data                 statement, old, initialized variables and arrays
  deallocate           statement, free up storage used by specified variable
  default              statement, in a select case structure, all others
  do                   construct, start a do loop
  double precision     statement, old, replaced by selected_real_kind(15,300)
  else                 construct, part of if   else if   else   end if
  else if              construct, part of if   else if   else   end if
  elsewhere            construct, part of where  elsewhere  end where
  end block data       construct, old, ends block data
  end do               construct, ends do
  end function         construct, ends function
  end if               construct, ends if
  end interface        construct, ends interface
  end module           construct, ends module
  end program          construct, ends program
  end select           construct, ends select case
  end subroutine       construct, ends subroutine
  end type             construct, ends type
  end where            construct, ends where
  entry                statement, old, another entry point in a procedure
  equivalence          statement, old, overlaid storage
  exit                 statement, continue execution outside of a do loop
  external             attribute, old statement, means defines else where
  function             construct, starts the definition of a function
  go to                statement, old, requires fixed form statement number
  if                   statement and construct, if(...) statement
  implicit             statement, &quot;none&quot; is preferred to help find errors
  in                   a keyword for intent, the argument is read only
  inout                a keyword for intent, the argument is read/write
  integer              statement, basic type, intrinsic data type
  intent               attribute, intent(in) or intent(out) or intent(inout)
  interface            construct, begins an interface definition
  intrinsic            statement, says that following names are intrinsic
  kind                 attribute, sets the kind of the following variables
  len                  attribute, sets the length of a character string
  logical              statement, basic type, intrinsic data type
  module               construct, beginning of a module definition
  namelist             statement, defines a namelist of input/output
  nullify              statement, nullify(some_pointer) now points nowhere
  only                 attribute, restrict what comes from a module
  operator             attribute, indicates function is an operator, like +
  optional             attribute, a parameter or argument is optional
  out                  a keyword for intent, the argument will be written
  parameter            attribute, old statement, makes variable real only
  pause                old, replaced by stop
  pointer              attribute, defined the variable as a pointer alias
  private              statement and attribute, in a module, visible inside
  program              construct, start of a main program
  public               statement and attribute, in a module, visible outside
  real                 statement, basic type, intrinsic data type
  recursive            attribute, allows functions and derived type recursion
  result               attribute, allows naming of function result  result(Y)
  return               statement, returns from, exits, subroutine or function
  save                 attribute, old statement, keep value between calls
  select case          construct, start of a case construct
  stop                 statement, terminate execution of the main procedure
  subroutine           construct, start of a subroutine definition
  target               attribute, allows a variable to take a pointer alias
  then                 part of if construct
  type                 construct, start of user defined type
  type ( )             statement, declaration of a variable for a users type
  use                  statement, brings in a module
  where                construct, conditional assignment
  while                construct, a while form of a do loop
</code></pre></div>
<h2 id="key-words-related-to-io">Key words related to I/O</h2>
<div class="highlight"><pre><span></span><code>  backspace            statement, back up one record
  close                statement, close a file
  endfile              statement, mark the end of a file
  format               statement, old, defines a format
  inquire              statement, get the status of a unit
  open                 statement, open or create a file
  print                statement, performs output to screen
  read                 statement, performs input
  rewind               statement, move read or write position to beginning
  write                statement, performs output
</code></pre></div>
<h2 id="operators">Operators</h2>
<div class="highlight"><pre><span></span><code>  **    exponentiation
  *     multiplication
  /     division
  +     addition
  -     subtraction
  //    concatenation
  ==    .eq.  equality
  /=    .ne.  not equal
  &lt;     .lt.  less than
  &gt;     .gt.  greater than
  &lt;=    .le.  less than or equal
  &gt;=    .ge.  greater than or equal
  .not.       complement, negation
  .and.       logical and
  .or.        logical or
  .eqv.       logical equivalence
  .neqv.      logical not equivalence, exclusive or

  .eq.  ==    equality, old
  .ne.  /=    not equal. old
  .lt.  &lt;     less than, old
  .gt.  &gt;     greater than, old
  .le.  &lt;=    less than or equal, old
  .ge.  &gt;=    greater than or equal, old


  Other punctuation:

   /  ...  /  used in data, common, namelist and other statements
   (/ ... /)  array constructor, data is separated by commas
   6*1.0      in some contexts, 6 copies of 1.0
   (i:j:k)    in some contexts, a list  i, i+k, i+2k, i+3k, ... i+nk&amp;le;j
   (:j)       j and all below
   (i:)       i and all above
   (:)        undefined or all in range
</code></pre></div>
<h2 id="constants">Constants</h2>
<div class="highlight"><pre><span></span><code>  Logical constants:

    .true.      True
    .false.     False

  Integer constants:

     0    1     -1     123456789

  Real constants:

     0.0   1.0   -1.0    123.456   7.1E+10   -52.715E-30

  Complex constants:

     (0.0, 0.0)    (-123.456E+30, 987.654E-29)

  Character constants:

      &quot;ABC&quot;   &quot;a&quot;  &quot;123&#39;abc$%#@!&quot;    &quot; a quote &quot;&quot; &quot;
      &#39;ABC&#39;   &#39;a&#39;  &#39;123&quot;abc$%#@!&#39;    &#39; a apostrophe &#39;&#39; &#39;

  Derived type values:

      type name
        character (len=30) :: last
        character (len=30) :: first
        character (len=30) :: middle
      end type name

      type address
        character (len=40) :: street
        character (len=40) :: more
        character (len=20) :: city
        character (len=2)  :: state
        integer (selected_int_kind(5)) :: zip_code
        integer (selected_int_kind(4)) :: route_code
      end type address

      type person
        type (name) lfm
        type (address) snail_mail
      end type person

      type (person) :: a_person = person( name(&quot;Squire&quot;,&quot;Jon&quot;,&quot;S.&quot;), &amp;amp;
          address(&quot;106 Regency Circle&quot;, &quot;&quot;, &quot;Linthicum&quot;, &quot;MD&quot;, 21090, 1936))

      a_person%snail_mail%route_code == 1936
</code></pre></div>
<h2 id="inputoutput-statements">Input/Output Statements</h2>
<div class="highlight"><pre><span></span><code>    open (&lt;unit number&gt;)
    open (unit=&lt;unit number&gt;, file=&lt;file name&gt;, iostat=&lt;variable&gt;)
    open (unit=&lt;unit number&gt;, ... many more, see below )

    close (&lt;unit number&gt;)
    close (unit=&lt;unit number&gt;, iostat=&lt;variable&gt;,
           err=&lt;statement number&gt;, status=&quot;KEEP&quot;)

    read (&lt;unit number&gt;) &lt;input list&gt;
    read (unit=&lt;unit number&gt;, fmt=&lt;format&gt;, iostat=&lt;variable&gt;,
          end=&lt;statement number&gt;, err=&lt;statement number&gt;) &lt;input list&gt;
    read (unit=&lt;unit number&gt;, rec=&lt;record number&gt;) &lt;input list&gt;

    write (&lt;unit number&gt;) &lt;output list&gt;
    write (unit=&lt;unit number&gt;, fmt=&lt;format&gt;, iostat=&lt;variable&gt;,
           err=&lt;statement number&gt;) &lt;output list&gt;
    write (unit=&lt;unit number&gt;, rec=&lt;record number&gt;) &lt;output list&gt;

    print *, &lt;output list&gt;

    print &quot;(&lt;your format here, use apostrophe, not quote&gt;)&quot;, &lt;output list&gt;

    rewind &lt;unit number&gt;
    rewind (&lt;unit number&gt;, err=&lt;statement number&gt;)

    backspace &lt;unit number&gt;
    backspace (&lt;unit number&gt;, iostat=&lt;variable&gt;)

    endfile &lt;unit number&gt;
    endfile (&lt;unit number&gt;, err=&lt;statement number&gt;, iostat=&lt;variable&gt;)

    inquire ( &lt;unit number&gt;, exists = &lt;variable&gt;)
    inquire ( file=&lt;&quot;name&quot;&gt;, opened = &lt;variable1&gt;, access = &lt;variable2&gt; )
    inquire ( iolength = &lt;variable&gt; ) x, y, A   ! gives &quot;recl&quot; for &quot;open&quot;

    namelist /&lt;name&gt;/ &lt;variable list&gt;      defines a name list
    read(*,nml=&lt;name&gt;)                     reads some/all variables in namelist
    write(*,nml=&lt;name&gt;)                    writes all variables in namelist
    &amp;amp;&lt;name&gt; &lt;variable&gt;=&lt;value&gt; ... &lt;variable=value&gt; /  data for namelist read

  Input / Output specifiers

    access   one of  &quot;sequential&quot;  &quot;direct&quot;  &quot;undefined&quot;
    action   one of  &quot;read&quot;  &quot;write&quot;  &quot;readwrite&quot;
    advance  one of  &quot;yes&quot;  &quot;no&quot;  
    blank    one of  &quot;null&quot;  &quot;zero&quot;
    delim    one of  &quot;apostrophe&quot;  &quot;quote&quot;  &quot;none&quot;
    end      =       &lt;integer statement number&gt;  old
    eor      =       &lt;integer statement number&gt;  old
    err      =       &lt;integer statement number&gt;  old
    exist    =       &lt;logical variable&gt;
    file     =       &lt;&quot;file name&quot;&gt;
    fmt      =       &lt;&quot;(format)&quot;&gt; or &lt;character variable&gt; format
    form     one of  &quot;formatted&quot;  &quot;unformatted&quot;  &quot;undefined&quot;
    iolength =       &lt;integer variable, size of unformatted record&gt;
    iostat   =       &lt;integer variable&gt; 0==good, negative==eof, positive==bad
    name     =       &lt;character variable for file name&gt;
    named    =       &lt;logical variable&gt;
    nml      =       &lt;namelist name&gt;
    nextrec  =       &lt;integer variable&gt;    one greater than written
    number   =       &lt;integer variable unit number&gt;
    opened   =       &lt;logical variable&gt;
    pad      one of  &quot;yes&quot;  &quot;no&quot;
    position one of  &quot;asis&quot;  &quot;rewind&quot;  &quot;append&quot;
    rec      =       &lt;integer record number&gt;
    recl     =       &lt;integer unformatted record size&gt;
    size     =       &lt;integer variable&gt;  number of characters read before eor
    status   one of  &quot;old&quot;  &quot;new&quot;  &quot;unknown&quot;  &quot;replace&quot;  &quot;scratch&quot;  &quot;keep&quot;
    unit     =       &lt;integer unit number&gt;

  Individual questions
    direct      =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
    formatted   =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
    read        =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
    readwrite   =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
    sequential  =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
    unformatted =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
    write       =    &lt;character variable&gt;  &quot;yes&quot;  &quot;no&quot;  &quot;unknown&quot;
</code></pre></div>
<h2 id="formats">Formats</h2>
<div class="highlight"><pre><span></span><code>    format                    an explicit format can replace * in any
                              I/O statement. Include the format in
                              apostrophes or quotes and keep the parenthesis.

    examples:
         print &quot;(3I5,/(2X,3F7.2/))&quot;, &lt;output list&gt;
         write(6, &#39;(a,E15.6E3/a,G15.2)&#39; ) &lt;output list&gt;
         read(unit=11, fmt=&quot;(i4, 4(f3.0,TR1))&quot; ) &lt;input list&gt;

    A format includes the opening and closing parenthesis.
    A format consists of format items and format control items separated by comma.
    A format may contain grouping parenthesis with an optional repeat count.

  Format Items, data edit descriptors:

    key:  w  is the total width of the field   (filled with *** if overflow)
          m  is the least number of digits in the (sub)field (optional)
          d  is the number of decimal digits in the field
          e  is the number of decimal digits in the exponent subfield
          c  is the repeat count for the format item
          n  is number of columns

    cAw     data of type character (w is optional)
    cBw.m   data of type integer with binary base
    cDw.d   data of type real -- same as E,  old double precision
    cEw.d   or Ew.dEe  data of type real
    cENw.d  or ENw.dEe  data of type real  -- exponent a multiple of 3
    cESw.d  or ESw.dEe  data of type real  -- first digit non zero
    cFw.d   data of type real  -- no exponent printed
    cGw.d   or Gw.dEe  data of type real  -- auto format to F or E
    nH      n characters follow the H,  no list item
    cIw.m   data of type integer
    cLw     data of type logical  --  .true.  or  .false.
    cOw.m   data of type integer with octal base
    cZw.m   data of type integer with hexadecimal base
    &quot;&lt;string&gt;&quot;  literal characters to output, no list item
    &#39;&lt;string&gt;&#39;  literal characters to output, no list item

  Format Control Items, control edit descriptors:

    BN      ignore non leading blanks in numeric fields
    BZ      treat nonleading blanks in numeric fields as zeros
    nP      apply scale factor to real format items   old
    S       printing of optional plus signs is processor dependent
    SP      print optional plus signs
    SS      do not print optional plus signs
    Tn      tab to specified column
    TLn     tab left n columns
    TRn     tab right n columns
    nX      tab right n columns
    /       end of record (implied / at end of all format statements)
    :       stop format processing if no more list items

  &lt;input list&gt; can be:
    a variable
    an array name
    an implied do   ((A(i,j),j=1,n) ,i=1,m)    parenthesis and commas as shown

    note: when there are more items in the input list than format items, the
          repeat rules for formats applies.

  &lt;output list&gt; can be:
    a constant
    a variable
    an expression
    an array name
    an implied do   ((A(i,j),j=1,n) ,i=1,m)    parenthesis and commas as shown

    note: when there are more items in the output list than format items, the
          repeat rules for formats applies.

  Repeat Rules for Formats:

    Each format item is used with a list item.  They are used in order.
    When there are more list items than format items, then the following
    rule applies:  There is an implied end of record, /, at the closing
    parenthesis of the format, this is processed.  Scan the format backwards
    to the first left parenthesis.  Use the repeat count, if any, in front
    of this parenthesis, continue to process format items and list items.

    Note: an infinite loop is possible
          print &quot;(3I5/(1X/))&quot;, I, J, K, L    may never stop
</code></pre></div>
<h2 id="intrinsic-functions">Intrinsic Functions</h2>
<div class="highlight"><pre><span></span><code>  Intrinsic Functions are presented in alphabetical order and then grouped
  by topic.  The function name appears first. The argument(s) and result
  give an indication of the type(s) of argument(s) and results.
  [,dim=] indicates an optional argument  &quot;dim&quot;.
  &quot;mask&quot; must be logical and usually conformable.
  &quot;character&quot; and &quot;string&quot; are used interchangeably.
  A brief description or additional information may appear.
</code></pre></div>
<h3 id="intrinsic-functions-alphabetical">Intrinsic Functions (alphabetical):</h3>
<div class="highlight"><pre><span></span><code>    abs(integer_real_complex) result(integer_real_complex)
    achar(integer) result(character)  integer to character
    acos(real) result(real)  arccosine  |real| &amp;le; 1.0   0&amp;le;result&amp;le;Pi
    adjustl(character)  result(character) left adjust, blanks go to back
    adjustr(character)  result(character) right adjust, blanks to front
    aimag(complex) result(real)  imaginary part
    aint(real [,kind=]) result(real)  truncate to integer toward zero
    all(mask [,dim]) result(logical)  true if all elements of mask are true
    allocated(array) result(logical)  true if array is allocated in memory
    anint(real [,kind=]) result(real)  round to nearest integer
    any(mask [,dim=}) result(logical)  true if any elements of mask are true
    asin(real) result(real)  arcsine  |real| &amp;le; 1.0   -Pi/2&amp;le;result&amp;le;Pi/2
    associated(pointer [,target=]) result(logical)  true if pointing
    atan(real) result(real)  arctangent  -Pi/2&amp;le;result&amp;le;Pi/2 
    atan2(y=real,x=real) result(real)  arctangent  -Pi&amp;le;result&amp;le;Pi
    bit_size(integer) result(integer)  size in bits in model of argument
    btest(i=integer,pos=integer) result(logical)  true if pos has a 1, pos=0..
    ceiling(real) result(real)  truncate to integer toward infinity
    char(integer [,kind=]) result(character)  integer to character [of kind]
    cmplx(x=real [,y=real] [kind=]) result(complex)  x+iy
    conjg(complex) result(complex)  reverse the sign of the imaginary part
    cos(real_complex) result(real_complex)  cosine
    cosh(real) result(real)  hyperbolic cosine
    count(mask [,dim=]) result(integer)  count of true entries in mask
    cshift(array,shift [,dim=]) circular shift elements of array, + is right
    date_and_time([date=] [,time=] [,zone=] [,values=])  y,m,d,utc,h,m,s,milli
    dble(integer_real_complex) result(real_kind_double)  convert to double
    digits(integer_real) result(integer)  number of bits to represent model
    dim(x=integer_real,y=integer_real) result(integer_real) proper subtraction
    dot_product(vector_a,vector_b) result(integer_real_complex) inner product
    dprod(x=real,y=real) result(x_times_y_double)  double precision product
    eoshift(array,shift [,boundary=] [,dim=])  end-off shift using boundary
    epsilon(real) result(real)  smallest positive number added to 1.0 /= 1.0
    exp(real_complex) result(real_complex)  e raised to a power
    exponent(real) result(integer)  the model exponent of the argument
    floor(real) result(real)  truncate to integer towards negative infinity
    fraction(real) result(real)  the model fractional part of the argument
    huge(integer_real) result(integer_real)  the largest model number
    iachar(character) result(integer)  position of character in ASCII sequence
    iand(integer,integer) result(integer)  bit by bit logical and
    ibclr(integer,pos) result(integer)  argument with pos bit cleared to zero
    ibits(integer,pos,len) result(integer)  extract len bits starting at pos
    ibset(integer,pos) result(integer)  argument with pos bit set to one
    ichar(character) result(integer)  pos in collating sequence of character
    ieor(integer,integer) result(integer)  bit by bit logical exclusive or
    index(string,substring [,back=])  result(integer)  pos of substring
    int(integer_real_complex) result(integer)  convert to integer
    ior(integer,integer) result(integer)  bit by bit logical or
    ishft(integer,shift) result(integer)  shift bits in argument by shift
    ishftc(integer, shift) result(integer)  shift circular bits in argument
    kind(any_intrinsic_type) result(integer)  value of the kind
    lbound(array,dim) result(integer)  smallest subscript of dim in array
    len(character) result(integer)  number of characters that can be in argument
    len_trim(character) result(integer)  length without trailing blanks
    lge(string_a,string_b) result(logical)  string_a &amp;ge; string_b
    lgt(string_a,string_b) result(logical)  string_a &gt; string_b
    lle(string_a,string_b) result(logical)  string_a &amp;le; string_b
    llt(string_a,string_b) result(logical)  string_a &lt; string_b
    log(real_complex) result(real_complex)  natural logarithm
    log10(real) result(real)  logarithm base 10
    logical(logical [,kind=])  convert to logical
    matmul(matrix,matrix) result(vector_matrix)  on integer_real_complex_logical
    max(a1,a2,a3,...) result(integer_real)  maximum of list of values
    maxexponent(real) result(integer)  maximum exponent of model type
    maxloc(array [,mask=]) result(integer_vector)  indices in array of maximum
    maxval(array [,dim=] [,mask=])  result(array_element)  maximum value
    merge(true_source,false_source,mask) result(source_type)  choose by mask
    min(a1,a2,a3,...) result(integer-real)  minimum of list of values
    minexponent(real) result(integer)  minimum(negative) exponent of model type
    minloc(array [,mask=]) result(integer_vector)  indices in array of minimum
    minval(array [,dim=] [,mask=])  result(array_element)  minimum value
    mod(a=integer_real,p) result(integer_real)  a modulo p
    modulo(a=integer_real,p) result(integer_real)  a modulo p
    mvbits(from,frompos,len,to,topos) result(integer)  move bits
    nearest(real,direction) result(real)  nearest value toward direction
    nint(real [,kind=]) result(real)  round to nearest integer value
    not(integer) result(integer)  bit by bit logical complement
    pack(array,mask [,vector=]) result(vector)  vector of elements from array
    present(argument) result(logical)  true if optional argument is supplied
    product(array [,dim=] [,mask=]) result(integer_real_complex)  product
    radix(integer_real) result(integer)  radix of integer or real model, 2
    random_number(harvest=real_out)  subroutine, uniform random number 0 to 1
    random_seed([size=] [,put=] [,get=])  subroutine to set random number seed
    range(integer_real_complex) result(integer_real)  decimal exponent of model
    real(integer_real_complex [,kind=]) result(real)  convert to real
    repeat(string,ncopies) result(string)  concatenate n copies of string
    reshape(source,shape,pad,order) result(array)  reshape source to array
    rrspacing(real) result(real)  reciprocal of relative spacing of model
    scale(real,integer) result(real)  multiply by  2**integer
    scan(string,set [,back]) result(integer)  position of first of set in string
    selected_int_kind(integer) result(integer)  kind number to represent digits
    selected_real_kind(integer,integer) result(integer)  kind of digits, exp
    set_exponent(real,integer) result(real)  put integer as exponent of real
    shape(array) result(integer_vector)  vector of dimension sizes
    sign(integer_real,integer_real) result(integer_real) sign of second on first
    sin(real_complex) result(real_complex)  sine of angle in radians
    sinh(real) result(real)  hyperbolic sine of argument
    size(array [,dim=]) result(integer)  number of elements in dimension
    spacing(real) result(real)  spacing of model numbers near argument
    spread(source,dim,ncopies) result(array)  expand dimension of source by 1
    sqrt(real_complex) result(real_complex)  square root of argument
    sum(array [,dim=] [,mask=]) result(integer_real_complex)  sum of elements
    system_clock([count=] [,count_rate=] [,count_max=])  subroutine, all out
    tan(real) result(real)  tangent of angle in radians
    tanh(real) result(real)  hyperbolic tangent of angle in radians
    tiny(real) result(real)  smallest positive model representation
    transfer(source,mold [,size]) result(mold_type)  same bits, new type
    transpose(matrix) result(matrix)  the transpose of a matrix
    trim(string) result(string)  trailing blanks are removed
    ubound(array,dim) result(integer)  largest subscript of dim in array
    unpack(vector,mask,field) result(v_type,mask_shape)  field when not mask
    verify(string,set [,back]) result(integer)  pos in string not in set
</code></pre></div>
<h3 id="intrinsic-functions-grouped-by-topic">Intrinsic Functions (grouped by topic):</h3>
<h4 id="intrinsic-functions-numeric">Intrinsic Functions (Numeric)</h4>
<div class="highlight"><pre><span></span><code>    abs(integer_real_complex) result(integer_real_complex)
    acos(real) result(real)  arccosine  |real| &amp;le; 1.0   0&amp;le;result&amp;le;Pi
    aimag(complex) result(real)  imaginary part
    aint(real [,kind=]) result(real)  truncate to integer toward zero
    anint(real [,kind=]) result(real)  round to nearest integer
    asin(real) result(real)  arcsine  |real| &amp;le; 1.0   -Pi/2&amp;le;result&amp;le;Pi/2
    atan(real) result(real)  arctangent  -Pi/2&amp;le;result&amp;le;Pi/2 
    atan2(y=real,x=real) result(real)  arctangent  -Pi&amp;le;result&amp;le;Pi
    ceiling(real) result(real)  truncate to integer toward infinity
    cmplx(x=real [,y=real] [kind=]) result(complex)  x+iy
    conjg(complex) result(complex)  reverse the sign of the imaginary part
    cos(real_complex) result(real_complex)  cosine
    cosh(real) result(real)  hyperbolic cosine
    dble(integer_real_complex) result(real_kind_double)  convert to double
    digits(integer_real) result(integer)  number of bits to represent model
    dim(x=integer_real,y=integer_real) result(integer_real) proper subtraction
    dot_product(vector_a,vector_b) result(integer_real_complex) inner product
    dprod(x=real,y=real) result(x_times_y_double)  double precision product
    epsilon(real) result(real)  smallest positive number added to 1.0 /= 1.0
    exp(real_complex) result(real_complex)  e raised to a power
    exponent(real) result(integer)  the model exponent of the argument
    floor(real) result(real)  truncate to integer towards negative infinity
    fraction(real) result(real)  the model fractional part of the argument
    huge(integer_real) result(integer_real)  the largest model number
    int(integer_real_complex) result(integer)  convert to integer
    log(real_complex) result(real_complex)  natural logarithm
    log10(real) result(real)  logarithm base 10
    matmul(matrix,matrix) result(vector_matrix)  on integer_real_complex_logical
    max(a1,a2,a3,...) result(integer_real)  maximum of list of values
    maxexponent(real) result(integer)  maximum exponent of model type
    maxloc(array [,mask=]) result(integer_vector)  indices in array of maximum
    maxval(array [,dim=] [,mask=])  result(array_element)  maximum value
    min(a1,a2,a3,...) result(integer-real)  minimum of list of values
    minexponent(real) result(integer)  minimum(negative) exponent of model type
    minloc(array [,mask=]) result(integer_vector)  indices in array of minimum
    minval(array [,dim=] [,mask=])  result(array_element)  minimum value
    mod(a=integer_real,p) result(integer_real)  a modulo p
    modulo(a=integer_real,p) result(integer_real)  a modulo p
    nearest(real,direction) result(real)  nearest value toward direction
    nint(real [,kind=]) result(real)  round to nearest integer value
    product(array [,dim=] [,mask=]) result(integer_real_complex)  product
    radix(integer_real) result(integer)  radix of integer or real model, 2
    random_number(harvest=real_out)  subroutine, uniform random number 0 to 1
    random_seed([size=] [,put=] [,get=])  subroutine to set random number seed
    range(integer_real_complex) result(integer_real)  decimal exponent of model
    real(integer_real_complex [,kind=]) result(real)  convert to real
    rrspacing(real) result(real)  reciprocal of relative spacing of model
    scale(real,integer) result(real)  multiply by  2**integer
    set_exponent(real,integer) result(real)  put integer as exponent of real
    sign(integer_real,integer_real) result(integer_real) sign of second on first
    sin(real_complex) result(real_complex)  sine of angle in radians
    sinh(real) result(real)  hyperbolic sine of argument
    spacing(real) result(real)  spacing of model numbers near argument
    sqrt(real_complex) result(real_complex)  square root of argument
    sum(array [,dim=] [,mask=]) result(integer_real_complex)  sum of elements
    tan(real) result(real)  tangent of angle in radians
    tanh(real) result(real)  hyperbolic tangent of angle in radians
    tiny(real) result(real)  smallest positive model representation
    transpose(matrix) result(matrix)  the transpose of a matrix
</code></pre></div>
<h4 id="intrinsic-functions-logical-and-bit">Intrinsic Functions (Logical and bit)</h4>
<div class="highlight"><pre><span></span><code>    all(mask [,dim]) result(logical)  true if all elements of mask are true
    any(mask [,dim=}) result(logical)  true if any elements of mask are true
    bit_size(integer) result(integer)  size in bits in model of argument
    btest(i=integer,pos=integer) result(logical)  true if pos has a 1, pos=0..
    count(mask [,dim=]) result(integer)  count of true entries in mask
    iand(integer,integer) result(integer)  bit by bit logical and
    ibclr(integer,pos) result(integer)  argument with pos bit cleared to zero
    ibits(integer,pos,len) result(integer)  extract len bits starting at pos
    ibset(integer,pos) result(integer)  argument with pos bit set to one
    ieor(integer,integer) result(integer)  bit by bit logical exclusive or
    ior(integer,integer) result(integer)  bit by bit logical or
    ishft(integer,shift) result(integer)  shift bits in argument by shift
    ishftc(integer, shift) result(integer)  shift circular bits in argument
    logical(logical [,kind=])  convert to logical
    matmul(matrix,matrix) result(vector_matrix)  on integer_real_complex_logical
    merge(true_source,false_source,mask) result(source_type)  choose by mask
    mvbits(from,frompos,len,to,topos) result(integer)  move bits
    not(integer) result(integer)  bit by bit logical complement
    transfer(source,mold [,size]) result(mold_type)  same bits, new type
</code></pre></div>
<h4 id="intrinsic-functions-character-or-string">Intrinsic Functions (Character or string)</h4>
<div class="highlight"><pre><span></span><code>    achar(integer) result(character)  integer to character
    adjustl(character)  result(character) left adjust, blanks go to back
    adjustr(character)  result(character) right adjust, blanks to front
    char(integer [,kind=]) result(character)  integer to character [of kind]
    iachar(character) result(integer)  position of character in ASCII sequence
    ichar(character) result(integer)  pos in collating sequence of character
    index(string,substring [,back=])  result(integer)  pos of substring
    len(character) result(integer)  number of characters that can be in argument
    len_trim(character) result(integer)  length without trailing blanks
    lge(string_a,string_b) result(logical)  string_a &amp;ge; string_b
    lgt(string_a,string_b) result(logical)  string_a &gt; string_b
    lle(string_a,string_b) result(logical)  string_a &amp;le; string_b
    llt(string_a,string_b) result(logical)  string_a &lt; string_b
    repeat(string,ncopies) result(string)  concatenate n copies of string
    scan(string,set [,back]) result(integer)  position of first of set in string
    trim(string) result(string)  trailing blanks are removed
    verify(string,set [,back]) result(integer)  pos in string not in set
</code></pre></div>
<h2 id="fortran-95">Fortran 95</h2>
<ul>
<li>New Features<ul>
<li>The statement <strong>FORALL</strong> as an alternative to the DO-statement</li>
<li>Partial nesting of FORALL and WHERE statements</li>
<li>Masked ELSEWHERE</li>
<li>Pure procedures</li>
<li>Elemental procedures</li>
<li>Pure procedures in specification expressions</li>
<li>Revised MINLOC and MAXLOC</li>
<li>Extensions to CEILING and FLOOR with the KIND keyword argument</li>
<li>Pointer initialization</li>
<li>Default initialization of derived type objects</li>
<li>Increased compatibility with IEEE arithmetic</li>
<li>A CPU_TIME intrinsic subroutine</li>
<li>A function NULL to nullify a pointer</li>
<li><strong>Automatic deallocation of allocatable arrays at exit of scoping unit</strong></li>
<li>Comments in NAMELIST at input</li>
<li>Minimal field at input</li>
<li>Complete version of END INTERFACE</li>
</ul>
</li>
<li>Deleted Features<ul>
<li>real and double precision DO loop index variables</li>
<li>branching to END IF from an outer block</li>
<li>PAUSE statements</li>
<li>ASSIGN statements and assigned GO TO statements and the use of an assigned
    integer as a FORMAT specification</li>
<li>Hollerith editing in FORMAT</li>
<li>See <a href="http://www.nsc.liu.se/~boein/f77to90/f95.html#17.5">http://www.nsc.liu.se/~boein/f77to90/f95.html#17.5</a></li>
</ul>
</li>
</ul>
<hr />
<hr />
<h2 id="references">References</h2>
<ul>
<li><a href="http://www.fortran.com/fortran/">http://www.fortran.com/fortran/</a> Pointer to everything Fortran</li>
<li><a href="http://meteora.ucsd.edu/~pierce/fxdr_home_page.html">http://meteora.ucsd.edu/~pierce/fxdr_home_page.html</a> Subroutines to do unformatted I/O across platforms, provided by David Pierce at UCSD</li>
<li><a href="http://www.nsc.liu.se/~boein/f77to90/a5.html">http://www.nsc.liu.se/~boein/f77to90/a5.html</a> A good reference for intrinsic functions</li>
<li><a href="https://wg5-fortran.org/N1551-N1600/N1579.pdf">https://wg5-fortran.org/N1551-N1600/N1579.pdf</a>New Features of Fortran 2003</li>
<li><a href="https://wg5-fortran.org/N1701-N1750/N1729.pdf">https://wg5-fortran.org/N1701-N1750/N1729.pdf</a>New Features of Fortran 2008</li>
<li><a href="http://www.nsc.liu.se/~boein/f77to90/">http://www.nsc.liu.se/~boein/f77to90/</a> Fortran 90 for the Fortran 77 Programmer</li>
<li><b>Fortran 90 Handbook Complete ANSI/ISO Reference</b>. Jeanne Adams, Walt Brainerd, Jeanne Martin, Brian Smith, Jerrold Wagener</li>
<li><b>Fortran 90 Programming</b>. T. Ellis, Ivor Philips, Thomas Lahey</li>
<li><a href="https://github.com/llvm/llvm-project/blob/master/flang/docs/FortranForCProgrammers.md">https://github.com/llvm/llvm-project/blob/master/flang/docs/FortranForCProgrammers.md</a></li>
<li><a href="../mkl/">FFT stuff</a></li>
<li><a href="../95/">Fortran 95 and beyond</a></li>
</ul>
<!-- 
- [French Translation provided by Mary Orban](http://www.pkwteile.ch/science/avancee-fortran-90/)
- [Belorussian translation](http://webhostingrating.com/libs/pashyrany-fortran-90-be) provided by [webhostingrating.com](http://webhostingrating.com/)
- [http://www.dmoz.org/Computers/Programming/Languages/Fortran/FAQs,_Help,_and_Tutorials/Fortran_90_and_95/](http://www.dmoz.org/Computers/Programming/Languages/Fortran/FAQs,_Help,_and_Tutorials/Fortran_90_and_95/) Cray's Manual
- [http://www.nova.edu/ocean/psplot.html](http://www.nova.edu/ocean/psplot.html) Postscript plotting library
- [http://www.fortran.com/fortran_storenew/Html/Info/books/key10.pdf](http://www.fortran.com/fortran_storenew/Html/Info/books/key10.pdf)Key Features of Fortran 90
-->

<hr />
<hr />
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <nav
      class="md-footer__inner md-grid"
      aria-label="Footer"
    >

      <!-- Link to previous page -->
      
        
        <a
          href="../../../Systems/Swift/swift/"
          class="md-footer__link md-footer__link--prev"
          aria-label="Previous: Swift"
          rel="prev"
        >
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Swift
            </div>
          </div>
        </a>
      

      <!-- Link to next page -->
      
        
        <a
          href="../../python/NREL_python/"
          class="md-footer__link md-footer__link--next"
          aria-label="Next: NREL HPC Python"
          rel="next"
        >
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              NREL HPC Python
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
	<a href="https://www.nrel.gov/computational-science/"
	   title="Computational Science at NREL">Computational Science at NREL</a><br>
	<a href="https://www.nrel.gov/hpc/about-hpc.html" target="_blank"
	   title="About NREL High-Performance Computing">About NREL High-Performance Computing</a><br>
	<a href="https://www.nrel.gov/hpc/contact-us.html" target="_blank"
	   title="Contact Us">Contact Us</a><br>
      </div>
    </div>
  </div>
<footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>